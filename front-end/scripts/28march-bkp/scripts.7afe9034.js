window.Polimapper||(Polimapper={}),function(e,a,o){Polimapper.maindata={},window.Polimapper||(Polimapper={}),"localhost"===location.hostname||"127.0.0.1"===location.hostname||"stage.visualisation.polimapper.co.uk"===location.hostname?Polimapper.baseUrl="https://stage.visualisation.polimapper.co.uk":Polimapper.baseUrl="https://visualisation.polimapper.co.uk";window.addthis_share={url:window.location.href,title:document.title},setTimeout(function(){e(document).ready(function(){if(Polimapper.container&&(e("#"+Polimapper.container).children(".polimapper-desktop")&&e("#"+Polimapper.container).append('<div class="polimapper-desktop"></div>'),e("#"+Polimapper.container).children(".polimapper-mobile")&&e("#"+Polimapper.container).append('<div class="polimapper-mobile"></div>')),Polimapper.insertDesktopLayout(),e(".closes").on("click",function(){e(".custom-wrapper-node-view").show(),e(".node-view-charts").hide(),e("#con_over").hide(),e(".con_name").remove(),e(this).hide(),e(".constituency-view #data, .constituency-view .map").addClass("col-md-6"),e(".constituency-view #data").removeClass("col-md-8"),e(".constituency-view .map").removeClass("col-md-4"),e(".app_wrapper").removeClass("constituency-view"),e(".results").css({background:"none"}),e("#data .results").empty().append(Polimapper.maindata),e("#sel_con").get(0).selectedIndex=0,e(".node-description-wraper").hide(),e(".node-intro-wraper").hide(),e("#data .results").show()}),Polimapper.key||(Polimapper.key=Polimapper.getUrlVariable("dataSetKey")),Polimapper.group||(Polimapper.group=Polimapper.getUrlVariable("group")),Polimapper.client||(Polimapper.client=Polimapper.getUrlVariable("client")),!1!==Polimapper.group)var r=Polimapper.key,i=Polimapper.group,p={proKey:r,clientKey:Polimapper.client?Polimapper.client:null,groupKey:i};else p={proKey:r=Polimapper.key,clientKey:Polimapper.client?Polimapper.client:null};e("#data .results").prepend('<div class="col-xs-12 loading"><div><div class="triforce"></div></div><p style="margin-top:130px;font-size:20px">Please wait, map loading.</p></div>'),e("body").addClass("fixed-body"),Polimapper.loadDataset(p,function(){Polimapper.insertUkConstituencyMap(Polimapper.data.topology.mapTemplatePath,function(){Polimapper.setColors(Polimapper.data),Polimapper.setMapDetails(),Polimapper.orderDatafields(Polimapper.data.dataFields),Polimapper.loadDatafieldText();var r,i=a.filter(Polimapper.data.dataFields,function(e){return e.comparable});if(i[0]&&(r=i[0]).columns[0]&&r.columns[0],Polimapper.data.dataFields.length>0){var n=e("#datafieldselectedValue").text();Polimapper.paintMap(n,n)}if(Polimapper.summaryData(),Polimapper.loadScript(Polimapper.data.embeddedCode),Polimapper.displayNodeFromUrl(),Polimapper.getNodes(p),e("#data_selector .icon").click(function(){e("#data_selector .icon").removeClass("selected"),e(this).addClass("selected"),Polimapper.paintMap(e(this).data("name"))}),e("#data_selector").bind("change",function(){Polimapper.paintMap(e(this).find(":selected").data("fieldName"),e(this).find(":selected").data("name"))}),e("#data_selector .icon").bind("mouseover",function(a){e("#cons_name_overlay").empty().append(e(this).data("name"))}),e("#data_selector .icon").bind(" mouseenter",function(){e("#cons_name_overlay").show()}).mouseleave(function(){e("#cons_name_overlay").hide()}),Polimapper.isOnline()||e("#offline").modal("show"),e(window).width()<500);var s;if(e(window).width()<500){if("22"===Polimapper.data.topology.mapID)var m=.04;else if("23"===Polimapper.data.topology.mapID)m=.03;else if("24"===Polimapper.data.topology.mapID)m=.04;else if("25"===Polimapper.data.topology.mapID)m=.095;else if("28"==Polimapper.data.topology.mapID)m=.006;else if("29"==Polimapper.data.topology.mapID)m=.0095;else if("27"==Polimapper.data.topology.mapID)m=.0095;else if("3"==Polimapper.data.topology.mapID)m=.002;else if("6"==Polimapper.data.topology.mapID)m=.06;else if("5"==Polimapper.data.topology.mapID)m=.02;else if("12"==Polimapper.data.topology.mapID)m=.02;else if("13"==Polimapper.data.topology.mapID)m=.02;else if("14"==Polimapper.data.topology.mapID)m=.008;else if("21"==Polimapper.data.topology.mapID)m=.03;else m=.2;e(".pz").panzoom({$zoomIn:e("#buttons").find(".zoom-in"),$zoomOut:e("#buttons").find(".zoom-out"),startTransform:(s="scale(1)","9"===Polimapper.data.topology.mapID?s="scale(0.4)":"10"===Polimapper.data.topology.mapID?s="scale(0.18)":"7"===Polimapper.data.topology.mapID?s="scale(0.31)":"11"===Polimapper.data.topology.mapID?s="scale(0.31)":"4"===Polimapper.data.topology.mapID?s="scale(0.18)":"14"===Polimapper.data.topology.mapID?s="scale(0.02)":"13"===Polimapper.data.topology.mapID?s="scale(0.02)":"12"===Polimapper.data.topology.mapID?s="scale(0.038)":"1"===Polimapper.data.topology.mapID?s="scale(0.4)":"8"===Polimapper.data.topology.mapID?s="scale(0.2)":"19"===Polimapper.data.topology.mapID?s="scale(0.15)":"15"===Polimapper.data.topology.mapID?s="scale(0.4)":"16"===Polimapper.data.topology.mapID?s="scale(0.55)":"22"===Polimapper.data.topology.mapID?s="scale(0.0001)":"21"===Polimapper.data.topology.mapID?s="scale(0.045)":"24"===Polimapper.data.topology.mapID?s="scale(0.0001)":"23"===Polimapper.data.topology.mapID?s="scale(0.03)":"25"===Polimapper.data.topology.mapID?s="scale(0.0001)":"28"==Polimapper.data.topology.mapID?s="scale(0.006)":"29"==Polimapper.data.topology.mapID?s="scale(0.01)":"27"==Polimapper.data.topology.mapID?s="scale(0.085)":"3"==Polimapper.data.topology.mapID?s="scale(0.003)":"6"==Polimapper.data.topology.mapID?s="scale(0.04)":"5"==Polimapper.data.topology.mapID?s="scale(0.0016)":"26"==Polimapper.data.topology.mapID?s="scale(0.35)":"20"==Polimapper.data.topology.mapID?s="scale(0.6)":"30"==Polimapper.data.topology.mapID?s="scale(0.5)":"17"==Polimapper.data.topology.mapID?s="scale(0.7)":"18"==Polimapper.data.topology.mapID&&(s="scale(0.7)"),s),maxScale:3,minScale:m,increment:.3}).panzoom("zoom")}else{if("22"===Polimapper.data.topology.mapID)m=.04;else if("23"===Polimapper.data.topology.mapID)m=.054;else if("24"===Polimapper.data.topology.mapID)m=.04;else if("25"===Polimapper.data.topology.mapID)m=.12;else if("28"===Polimapper.data.topology.mapID)m=.0114;else if("28"==Polimapper.data.topology.mapID)m=.0114;else if("29"==Polimapper.data.topology.mapID)m=.008;else if("27"==Polimapper.data.topology.mapID)m=.01;else if("3"==Polimapper.data.topology.mapID)m=.005;else if("6"==Polimapper.data.topology.mapID)m=.01;else if("5"==Polimapper.data.topology.mapID)m=.01;else if("12"==Polimapper.data.topology.mapID)m=.01;else if("13"==Polimapper.data.topology.mapID)m=.01;else if("14"==Polimapper.data.topology.mapID)m=.01;else if("21"==Polimapper.data.topology.mapID)m=.04;else m=.2;e(".pz").panzoom({$zoomIn:e("#buttons").find(".zoom-in"),$zoomOut:e("#buttons").find(".zoom-out"),startTransform:function(){var e="scale(1)";return"1"===Polimapper.data.topology.mapID?e="scale(0.5)":"7"===Polimapper.data.topology.mapID?e="scale(0.36)":"11"===Polimapper.data.topology.mapID?e="scale(0.35)":"12"===Polimapper.data.topology.mapID?e="scale(0.045)":"4"===Polimapper.data.topology.mapID?e="scale(0.2)":"9"===Polimapper.data.topology.mapID?e="scale(0.9)":"15"===Polimapper.data.topology.mapID?e="scale(0.7)":"8"===Polimapper.data.topology.mapID?e="scale(0.47)":"19"===Polimapper.data.topology.mapID?e="scale(0.33)":"14"===Polimapper.data.topology.mapID?e="scale(0.02)":"10"===Polimapper.data.topology.mapID?e="scale(0.4)":"13"===Polimapper.data.topology.mapID?e="scale(0.02)":"16"===Polimapper.data.topology.mapID?e="scale(0.7)":"22"===Polimapper.data.topology.mapID?e="scale(0.05)":"21"===Polimapper.data.topology.mapID?e="scale(0.04)":"24"===Polimapper.data.topology.mapID?e="scale(0.0001)":"23"===Polimapper.data.topology.mapID?e="scale(0.0001)":"25"===Polimapper.data.topology.mapID?e="scale(0.0001)":"26"==Polimapper.data.topology.mapID?e="scale(0.5)":"30"==Polimapper.data.topology.mapID?e="scale(.8)":"28"==Polimapper.data.topology.mapID?e="scale(0.0001)":"29"==Polimapper.data.topology.mapID?e="scale(0.015)":"27"==Polimapper.data.topology.mapID?e="scale(0.17)":"3"==Polimapper.data.topology.mapID?e="scale(0.005)":"6"==Polimapper.data.topology.mapID?e="scale(0.08)":"5"==Polimapper.data.topology.mapID?e="scale(0.035)":"20"==Polimapper.data.topology.mapID?e="scale(0.7)":"17"==Polimapper.data.topology.mapID?e="scale(0.7)":"18"==Polimapper.data.topology.mapID&&(e="scale(0.7)"),e}(),maxScale:3,minScale:m,increment:.3}).panzoom("zoom")}e("#submit_postcode").submit(function(a){return Polimapper.isOnline()?(Polimapper.getNode(p,e("#submit_postcode #postcode")[0].value),!1):(e("#offline2").modal("show"),!1)}),e("#overlay").click(function(){Polimapper.setPageTitle(Polimapper.data.title),addthis_share.url=window.location.href,Polimapper.summaryData()}),e("#close-constituency").click(function(){e("#data .results").empty().append(Polimapper.maindata),e(".constituency-view #data, .constituency-view .map").addClass("col-md-6"),e(".constituency-view #data").removeClass("col-md-8"),e(".constituency-view .map").removeClass("col-md-4"),e(".app_wrapper").removeClass("constituency-view"),e(".results").css({background:"none"}),e(".read-more-wrapper").each(function(){var a=e(this).html();if(a.length>100){var o=a.substr(0,100),l=a.substr(100,a.length-100),r=o+'<span class="moreellipses">...&nbsp;</span><span class="morecontent"><span>'+l+'</span>&nbsp;&nbsp;<a href="" class="morelink">'+t+"</a></span>";e(this).html(r)}}),e(".morelink").click(function(){return e(this).hasClass("less")?(e(this).removeClass("less"),e(this).html(t)):(e(this).addClass("less"),e(this).html(l)),e(this).parent().prev().toggle(),e(this).prev().toggle(),!1}),stickyNav(),e("#con_over").hide(),"map"===Polimapper.getHashParam("back")&&(e(".svg-modal").addClass("show"),e(".svg-modal .back-button").show(),e(".svg-modal .search-constituency").removeClass("open"),e(".results, .map-nav-container").hide()),Polimapper.setPageTitle(Polimapper.data.title),window.location.hash="";var a=window.location.href;a.indexOf("#")===a.length-1&&(a=a.substr(0,a.length-1)),addthis_share.url=a,Polimapper.summaryData()});var d,c=[1,11,7,4];function u(e){return a.find(Polimapper.data.nodes,function(a){return a.name===e})}function h(a,o){if(a){var t=u(a);if(t)return console.log("found node locally: "+t.name),l(t);Polimapper.getNode(p,a,function(e){var a=u(e.name);console.log("loaded node from api: "+a.name),l(a)})}function l(a){e('.search-constituency input[type="search"]').val(""),e(".search-constituency").removeClass("open"),e(".map-nav-container .showmap").removeClass("hide"),e(".svg-modal").removeClass("show"),e("body").removeClass("modal-open"),e(".results, .map-nav-container").show(),e(".app_wrapper").addClass("constituency-view"),e(".constituency-view #data, .constituency-view .map").removeClass("col-md-6"),e(".constituency-view #data").addClass("col-md-8"),e(".constituency-view .map").addClass("col-md-4"),e(".results").css({background:Polimapper.data.primaryColour}),e("#con_over").show(),setTimeout(function(){var t=e("path[data-name='"+a.name+"']").get(0);Polimapper.drawNode(t),o&&Polimapper.setHashParam("back",o)})}}function g(e){return{lookup:function(e,o){var t=Polimapper.nodesAutocomplete;e=e&&e.toLowerCase(),o({suggestions:a.filter(t,function(a){return-1!==a.value.toLowerCase().indexOf(e)}).slice(0,5)})},onSelect:function(a){a.data!==d&&(d=a.data,h(a.data,e))}}}if(-1===c.indexOf(Polimapper.data.topology.name)&&(e(".searchbox.postcode").show(),e(".searchbox.postcode .icon-wrapper").click(function(){e(".searchbox.postcode").toggleClass("expand")})),e(".svg_wrapper").on("touchmove",function(){!0}),e("path").on("touchstart",function(){!1}),e("#sel_con").on("change",function(){var a=e("path[data-name='"+this.value+"']").get(0),o=e("#sel_con").val(),t=Polimapper.getLocalData("nodes").find(({name:e})=>e===o);if(t){var l=t.data,r=e("#datafieldselectedValue").text();Polimapper.data.dataFields.find(({name:e})=>e===r);e(".node-view-charts").hide(),e(".node-wrap .node_view_wrapper").show(),e(".node-view-charts .node_view_wrapper").show(),e(".custom-wrapper-node-view").show(),e(".node_view_wrapper").empty();for(var i=0;i<Polimapper.data.chartWizard.length;i++)if("Node"==Polimapper.data.chartWizard[i].graph_for){var p=Polimapper.data.chartWizard[i].chart_name.replaceAll(" ","-");p+="_canvas";var n=Polimapper.data.chartWizard[i].graph_for+"chart";"full_width"==Polimapper.data.chartWizard[i].map_width?e(".node-wrap .node_view_wrapper").append("<div class="+n+" style='width:100%;'><div class='chart-wizard'><canvas id="+p+"></canvas></div></div>"):e(".node-wrap .node_view_wrapper").append("<div class="+n+" style='width:50%;'><div class='chart-wizard'><canvas id="+p+"></canvas></div></div>")}for(i=0;i<Polimapper.data.chartWizard.length;i++)if("Node"==Polimapper.data.chartWizard[i].graph_for){p=Polimapper.data.chartWizard[i].chart_name.replaceAll(" ","-");p+="_canvas";var s=Polimapper.data.chartWizard[i].display_name,m=Polimapper.data.chartWizard[i].x_axis_title,d=Polimapper.data.chartWizard[i].y_axis_title,c=Polimapper.data.chartWizard[i].graph_type.toLowerCase(),u=Polimapper.data.chartWizard[i].hide_average,h=Polimapper.data.chartWizard[i].average_color;"bar"==c&&(c="horizontalBar"),"column"==c&&(c="bar"),"donut"==c&&(c="doughnut");for(var g=!0,v=[],y=[],P=[],f=[],b=Polimapper.data.chartWizard[i].columns.length,w=[],C=[],k=0;k<Polimapper.data.chartWizard[i].columns.length;k++){if("line"==c&&(g=!1),"pie"==c||"doughnut"==c)var _=Polimapper.data.chartWizard[i].columns[k].label;else if("horizontalBar"==c)_=Polimapper.data.chartWizard[i].columns[k].label.match(/.{1,25}(\s|$)/g);else _=Polimapper.data.chartWizard[i].columns[k].label.match(/.{1,18}(\s|$)/g);P.push(_),f.push(Polimapper.data.chartWizard[i].columns[k].average);var x,S=Polimapper.data.chartWizard[i].columns[k].name;if(x=l.find(({name:e})=>e===S))var D=x.value;else if(x=l.find(({display_name:e})=>e===S))D=x.value;else D=void 0;if(""!=D&&" "!=D&&null!=D||(D=0),v.push(D),y.push(Polimapper.data.chartWizard[i].columns[k].field_color),"pie"==c||"doughnut"==c){w.push(D);var I=Polimapper.data.chartWizard[i].columns[k].field_color;C.push(I)}}if(1==u)var A=!0;else A=!1;if("pie"==c||"doughnut"==c)if(!0!==u)var F=[{label:"Total",data:w,backgroundColor:C}];else F=[{label:"Total",data:w,backgroundColor:C}];else if(!0!==u)F=[{label:o,tension:0,pointDot:g,fill:!1,borderWidth:1,borderColor:Polimapper.data.secondaryColour,backgroundColor:y,data:v}];else F=[{label:"Average",tension:0,fill:g,pointDot:!0,hidden:!1,borderWidth:1,borderColor:h,backgroundColor:h,data:f},{label:o,tension:0,pointDot:g,fill:!1,borderWidth:1,borderColor:Polimapper.data.secondaryColour,backgroundColor:y,data:v}];var N={labels:P,datasets:F},M=document.getElementById(p).getContext("2d");if("pie"==c||"doughnut"==c)var V={responsive:!0,fullWidth:1,tooltips:{callbacks:{title:function(e){return e[0].label},label:function(e,a){return a.datasets[e.datasetIndex].label},footer:function(e,a){e=e[0];var o=a.datasets[e.datasetIndex].data[e.index];return a.labels[e.index]+" : "+o}},displayColors:!1,yAlign:"bottom"},maintainAspectRatio:!1,title:{display:!0,text:s,fontSize:25,fontColor:"#000"},legend:{position:"bottom",onClick:function(e){e.stopPropagation()}}};else if("horizontalBar"==c)V={responsive:!0,fullWidth:1,tooltips:{callbacks:{title:function(){},label:function(e,a){return e.xLabel}},displayColors:!1,yAlign:"bottom"},maintainAspectRatio:!1,title:{display:!0,text:s,fontSize:25,fontColor:"#000"},legend:{display:A,position:"bottom",onClick:function(e,a){e.stopPropagation()}},scales:{yAxes:[{ticks:{beginAtZero:!0,autoSkip:!1}}],xAxes:[{ticks:{beginAtZero:!0,autoSkip:!1}}]}};else V={responsive:!0,fullWidth:1,showAllTooltips:!1,showToolrips:!0,tooltips:{callbacks:{title:function(){},label:function(e,a){return a.datasets[e.datasetIndex].data[e.index]}},displayColors:!1},maintainAspectRatio:!1,title:{display:!0,text:s,fontSize:25,fontColor:"#000"},legend:{position:"bottom",onClick:function(e){e.stopPropagation()}},scales:{yAxes:[{scaleLabel:{display:!0,fontSize:20,fontColor:"#000",labelString:d},ticks:{autoSkip:!1,beginAtZero:!0}}],xAxes:[{scaleLabel:{display:!0,fontSize:20,fontColor:"#000",labelString:m},ticks:{autoSkip:!1,beginAtZero:!0}}]}};Polimapper.chartFuntion(M,c,N,V,b,u),v=[],P=[],f=[],y=[]}}e(".modal").modal("hide"),e("#main-body").removeClass("modal-open"),e("#main-body").css("overflow","scroll"),Polimapper.drawNode(a),/\S/.test(Polimapper.data.nodeDescription)&&e(".node-description-wraper").show(),e(".node-intro-wraper").show()}),e(".svg_wrapper path").mousemove(function(a){var o=e(this).data("name");o&&(e("#cons_name_overlay").empty().append(o),leftPos=e(".pz").position().left,e("#cons_name_overlay").css("left",a.pageX-leftPos+200),e("#cons_name_overlay").css("top",a.pageY-150))}),e(".svg_wrapper path").mouseenter(function(){e(this).data("name")&&e("#cons_name_overlay").show()}).mouseleave(function(){e(this).data("name")&&e("#cons_name_overlay").hide()}),e(".sbm-twitter").click(function(){e("#twitter").modal("toggle"),e("#email").modal("hide"),e("#main-body").css("overflow","hidden")}),e(".email-mp").click(function(){e("#emailMp").modal("toggle"),e("#twitter").modal("hide"),e("#email").modal("hide"),e("#main-body").css("overflow","hidden")}),e("body").on("click",".sbm-email",function(){e("#email").modal("toggle"),e("#twitter").modal("hide"),e("#emailMp").modal("hide"),e("#main-body").css("overflow","hidden")}),e(".sbm-close").click(function(){e(".modal").hide(),e(".modal").removeClass("in"),e("body").removeClass("modal-open"),e("#main-body").css("overflow","scroll")}),e(".sbm-close-mail").click(function(){e("#mymailprivacy").hide(),e("#mymailprivacy").removeClass("in")}),e(".more-info").click(function(){e(".footer-take-over").addClass("show"),e("body").addClass("modal-open"),e(this).hide()}),e(".footer-take-over .close").click(function(){e(".footer-take-over").removeClass("show"),e("body").removeClass("modal-open"),e(".more-info").show()}),e(".svg-modal .back-button").click(function(){e(".svg-modal").removeClass("show"),e("body").removeClass("modal-open"),e(".results, .map-nav-container").show()}),stickyNav=function(){var a=e(".map-nav-container"),o=e(window).scrollTop();(window.pageYOffset||document.documentElement.scrollTop)>50?e(a).addClass("scroll-shadow"):o<50&&e(a).removeClass("scroll-shadow")},e(window).scroll(function(){stickyNav()}),-1===c.indexOf(Polimapper.data.topology.name)?e('.search-constituency input[type="search"]').attr("placeholder",Polimapper.data.topology.labelForSingularNode+"/Postcode"):e('.search-constituency input[type="search"]').attr("placeholder",Polimapper.data.topology.labelForSingularNode),e('.map-nav-container .search-constituency input[type="search"]').autocomplete(g()),e(".map-nav-container .search-constituency form").submit(function(e){return e.preventDefault(),h(jQuery('.search-constituency input[type="search"]').val()),!1}),e(".map-nav-container .search-constituency").click(function(){e(this).hasClass("open")?h(e('input[type="search"]',this).val()):(e(this).addClass("open"),e(".map-nav-container .showmap").addClass("hide"))}),e('.svg-modal .search-constituency input[type="search"]').autocomplete(g("map")),e(".svg-modal .search-constituency form").submit(function(e){return e.preventDefault(),h(jQuery('.search-constituency input[type="search"]').val(),"map"),!1}),e(".svg-modal .search-constituency").click(function(){e(this).hasClass("open")?h(e('input[type="search"]',this).val(),"map"):(e(this).addClass("open"),e(".svg-modal .back-button").hide())}),e(".app_wrapper").click(function(){e(".map-nav-container .search-constituency").removeClass("open"),e(".map-nav-container .showmap").removeClass("hide")}),e(".svg_wrapper").click(function(){e(".svg-modal .search-constituency").removeClass("open"),e(".svg-modal .back-button").show()}),e(".svg-modal .legend").click(function(){e(this).toggleClass("show"),e(".dtfield .icon").toggleClass("icon-arrow-down3"),e(".dtfield .icon").toggleClass("icon-arrow-up3")}),o.defaults.global.scaleFontFamily="'oxygen', 'Helvetica', 'Arial', sans-serif",o.defaults.global.tooltipFontFamily="'oxygen', 'Helvetica', 'Arial', sans-serif",o.defaults.global.tooltipTitleFontFamily="'oxygen', 'Helvetica', 'Arial', sans-serif",o.defaults.global.tooltipTemplate="<%if (label){%><%=label%>: <%}%><%= Polimapper.addCommas(value) %>",Polimapper.isMobile()){v=0;e(".svg_wrapper path").on("touchstart",function(a){if(e("#cons_name_overlay").empty().append(e(this).data("name")),0==v)v=(new Date).getTime();else if((new Date).getTime()-v<800){var o=e("#cons_name_overlay").html(),t=Polimapper.getLocalData("nodes").find(({name:e})=>e===o);void 0===t?(e("#undefined").show(),e("#undefined").html(o+" is not found.").fadeOut(4e3)):(e("#undefined").hide(),e("#sel_con").val(t.name).change(),e(".closes").show()),v=0}else v=(new Date).getTime()})}else{var v=0;e(".svg_wrapper path").on("touchstart",function(a){if(e("#cons_name_overlay").empty().append(e(this).data("name")),0==v)v=(new Date).getTime();else if((new Date).getTime()-v<800){var o=e("#cons_name_overlay").html(),t=Polimapper.getLocalData("nodes").find(({name:e})=>e===o);void 0===t?(e("#undefined").show(),e("#undefined").html(o+" is not found.").fadeOut(4e3)):(e("#undefined").hide(),e("#sel_con").val(t.name).change(),e(".closes").show()),v=0}else v=(new Date).getTime()})}})})})},0),Polimapper.tweetCurrentPage=function(){var e="polimapper";return"72bc86358fc244dfb1135cc1205436de"===Polimapper.key&&(e="jrf_uk"),window.open("https://twitter.com/share?url="+escape(window.location.href)+"&text="+Polimapper.data.title+" via @"+e,"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600"),!1},Polimapper.fbShareCurrentPage=function(){return window.open("https://www.facebook.com/sharer/sharer.php?u="+escape(window.location.href)+"&p[title]="+Polimapper.data.title+"&p[images][0]="+Polimapper.data.logo,"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600"),!1},Polimapper.lkShareCurrentPage=function(){return window.open("https://www.linkedin.com/shareArticle?mini=true&url="+escape(window.location.href)+"&title="+Polimapper.data.title,"","menubar=no,toolbar=no,resizable=yes,scrollbars=yes,height=300,width=600"),!1},Polimapper.isOnline=function(){return!navigator||navigator.onLine};var t="Show more",l="Show less"}(Polimapper.$||window.$,Polimapper._||window._,Polimapper.Chart||window.Chart),window.Polimapper||(Polimapper={}),function(e,a,o){function t(e){return e.substr(0,22).trim()+".."}Polimapper.loadData=function(a,o,t,l){if(Polimapper.isOnline())e.ajax({crossDomain:!0,type:"GET",url:o,data:t,dataType:"json",async:!0,success:function(o){if("nodes"==a&&Polimapper.setLocalData(a,o.nodes),"400"==o.status)return e(".polimapper").remove(),e("body").html('<div class="btn-danger"><h2 style="height: 100vh; justify-content: center; display: flex; align-items: center;">'+o.msg+"</h2></div>"),!1;l(o)},error:function(e){var o=Polimapper.getLocalData(a);o&&l(o)}});else{var r=Polimapper.getLocalData(a);r&&l(r)}},Polimapper.getNodes=function(o){if(o.groupKey)var t=Polimapper.baseUrl+"/nodes/?dataSetKey="+o.proKey+"&client="+o.clientKey;else t=Polimapper.baseUrl+"/nodes/?dataSetKey="+o.proKey+"&client="+o.clientKey;Polimapper.loadData("nodes",t,{},function(o){e("#sel_con").get(0);if("Area"==Polimapper.data.topology.labelForSingularNode||"Authority"==Polimapper.data.topology.labelForSingularNode)var t="<option selected disable>Enter an "+Polimapper.data.topology.labelForSingularNode+"</option>";else t="<option selected disable>Enter a "+Polimapper.data.topology.labelForSingularNode+"</option>";for(e("#sel_con").append(t),"object"!=typeof o&&(o=JSON.parse(o)),i=0;i<o.nodes.length;++i){var l=o.nodes[i].name,r=Polimapper.templates["src/templates/select.handlebars"],p=Polimapper.templates["src/templates/selectMobile.handlebars"],n={name:l,value:l},s=r({name:l,value:l});p(n);e("#sel_con").append(s)}var m=window.location.href.split("#")[1];if(m){var d=decodeURIComponent(m.split("=")[1]);e("#sel_con").val(d).change()}Polimapper.nodesAutocomplete=a.map(o.nodes,function(e){return{value:e.name,data:e.name}})})},Polimapper.getNode=function(a,o,t){if(a.groupKey)var l=Polimapper.baseUrl+"/nodes/?dataSetKey="+a.proKey+"&client="+a.clientKey;else l=Polimapper.baseUrl+"/nodes/?dataSetKey="+a.proKey+"&client="+a.clientKey;var r="node_by_query_"+o;Polimapper.loadData(r,l,{query:o,dataSetTopology:Polimapper.data.topology.id},function(a){if(t)t(a);else{var o=e("path[data-name='"+a.name+"']").get(0);Polimapper.drawNode(o)}})},Polimapper.loadDatafieldIcons=function(){},Polimapper.loadDatafieldText=function(){e("#data_selector.icons").hide();var a=null,o=[];Polimapper.data.dataFields.forEach(function(e){e.isGroup&&0!=e.comparable?(e.child=[],a=e,o.push(a)):a&&"0"!==e.parentId&&0!=e.comparable?a.child.push(e):!1===e.comparable||o.push(e)});for(var t=0;t<o.length;t++)if(1==o[t].isGroup){var l="";if(o[t].child&&o[t].child.length>1){l="<ul class='sub_group'>"+o[t].child.map(function(e){return"<li class='ischild' id='"+e.sequence_no+"' value='"+e.name+"'  data-field-name='"+e.name+"'><span>"+e.name+"</span></li>"}).join("")+"</ul>";e("#data_con").append("<li class=isparent id='"+o[t].sequence_no+"' value='"+o[t].name+"' data-field-name='"+o[t].name+"'><span>"+o[t].name+"</span>"+l+"</li>")}else o[t].child&&1==o[t].child.length&&e("#data_con").append("<li  id='"+o[t].sequence_no+"' value='"+o[t].child[0].name+"' data-field-name='"+o[t].child[0].name+"'><span>"+o[t].child[0].name+"</span>"+l+"</li>")}else"0"!==o[t].parentId?e("#data_con").append("<li class='ischild'"+t+" id='"+o[t].sequence_no+"' value='"+o[t].name+"' data-field-name='"+o[t].name+"'>"+o[t].name+"</li>"):e("#data_con").append("<li id='"+o[t].sequence_no+"' value='"+o[t].name+"' data-field-name='"+o[t].name+"'><span>"+o[t].name+"</span></li>");e("#data_con").bind("click",function(){var a=e("#datafieldselectedValue").text();Polimapper.paintMap(a,a)});var r=e("#data_con-mobile .data-field-mobile"),i=(e("#data_con-mobile .data-field-mobile.selected"),r.length);for(i>0&&e(r).first().addClass("selected"),t=0;t<i;t++)e("#dots").append("<div class='dot'></div>");e("#dots .dot").length>0&&e(".dot").first().addClass("selected")},Polimapper.loadDataset=function(e,a){if(e.groupKey){var o=Polimapper.baseUrl+"/generator/",t="dataset_"+e.proKey;Polimapper.loadData(t,o,{dataSetKey:e.proKey,client:e.clientKey,group:e.groupKey},function(e){"object"!=typeof e&&(e=JSON.parse(e));for(var o=0;o<e.nodes.length;o++)e.nodes[o]=new Polimapper.Node(e.nodes[o]);Polimapper.data=e,a()})}else{o=Polimapper.baseUrl+"/generator/",t="dataset_"+e;Polimapper.loadData(t,o,{dataSetKey:e.proKey,client:e.clientKey},function(e){"object"!=typeof e&&(e=JSON.parse(e));for(var o=0;o<e.nodes.length;o++)e.nodes[o]=new Polimapper.Node(e.nodes[o]);Polimapper.data=e,a()})}},Polimapper.loadNodeData=function(a){Polimapper.data.hideNode,Polimapper.data.dataFields;var o=e("path[data-name='"+a+"']").get(0),l=Polimapper.data[o.className.baseVal.trim()];if(l||(l="#dedede"),"localhost"===location.hostname||"127.0.0.1"===location.hostname?loc="":loc="front-end/",a=Polimapper.arrayLookup(Polimapper.data.nodes,"name",a),Polimapper.loadRankingIcons(a),e("#data .results").empty().html('<div class="col-xs-12 loading"><div><div class="triforce"></div></div><p style="margin-top:130px;font-size:20px">Please wait, map loading.</p></div>'),e("#data .results").empty(),"41a8db966f6446b8803d0a33094f61b1"===Polimapper.data.key){if("South Manchester"===e(o).attr("data-name")||"Central Manchester"===e(o).attr("data-name")||"North Manchester"===e(o).attr("data-name")){e(".con_name").empty(),e("#data").prepend("<h2 class=\"con_name\"><div onclick='goBack()' class='con_name_div'><img src='"+loc+"img/arrow.png' alt='back'>"+e(o).attr("data-name")+"*</div></h2>");var r=e("<style> .con_name, .con_name div  { color: "+Polimapper.data.primaryColour+" !important;}  </style>");e("html > head").append(r),e(".con_name_div svg path").css("fill",Polimapper.data.primaryColour)}}else{e(".con_name").empty(),e("#data").prepend("<h2 class=\"con_name\"><div onclick='goBack()' class='con_name_div'><img src='"+loc+"img/arrow.png' alt='back'>"+e(o).attr("data-name")+"</div></h2>"),e(".con_name_div svg path").css("fill",Polimapper.data.primaryColour);r=e("<style> .con_name, .con_name div { color: "+Polimapper.data.primaryColour+" !important;}  </style>");e("html > head").append(r)}for(var i=[],p=0;p<Polimapper.data.dataFields.length;p++)1!=Polimapper.data.dataFields[p].hide_node&&i.push(Polimapper.data.dataFields[p]);e(".graph-wrapper").html(""),0==i.length?e("#data .results").hide():e("#data .results").show();for(p=0;p<i.length;p++){var n=i[p],s=n.name,m=n.columns[0].label?n.columns[0].label:n.name,d=a.columnValue(s,s);if(1!=n.hide_empty_valu_on_node||d){var c="";switch(n.type){case"Pound":case"Euro":case"Dollar":case"Decimal":case"Number":"Pound"===n.type&&(c="&#163; "),"Dollar"===n.type&&(c="&#36; "),"Euro"===n.type&&(c="&#128; ");d=a.columnValue(s,s);var u="",h="",g="",v=0,y=0,P=Polimapper.getLocalData("nodes");if(P){var f=P.find(({name:e})=>e===a.name);if(f){var b=f.data.find(({name:e})=>e===n.unique_name);b&&(y=b.value)}}n.columns.forEach(function(e,o){var t=a.column(n.name,e.name);g=g+","+e.label,u=u+","+e.icon,t&&t.value&&(h=h+","+t.value,o===n.columns.length-1&&(v+=parseFloat(t.value)))}),h=Polimapper.parseValueStrings(h),g=Polimapper.parseValueStrings(g),u=Polimapper.parseValueStrings(u),n.isMultivalued?d=n.showTotalInDataSetSummary?parseFloat(v.toFixed(2)):"":(g[0]=Polimapper.data.topology.labelForSingularNode,u=[n.columns[0].icon]),""===u&&(u=[]);var w="",C="";"Pound"===n.type&&(C="&#163; "),"Dollar"===n.type&&(C="&#36; "),"Euro"===n.type&&(C="&#128; ");var k="";if("Percentage"===n.type&&(k="%"),n.includeAverageInNodeGraphs){for(var _=0;_<n.columns.length;_++)w=n.averageOverride?w+","+Number(n.columns[_].averageOverride).toFixed(2):w+","+Number(n.columns[_].average).toFixed(2);w=Polimapper.parseValueStrings(w),w=(w=parseFloat(w)).toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),w=Polimapper.decodeHtml(C)+w+" "+k}var x="";if(n.columns[0].displayRankings){var S=null;S=n.columns[0].invertRankings?Polimapper.orderNodesByColumnValue(n.name,n.columns[0].name).reverse():Polimapper.orderNodesByColumnValue(n.name,n.columns[0].name),x="#"+(Polimapper.arrayRankingLookup(S,n.name,n.columns[0].name,a.columnValue(n.name,n.columns[0].name))+1)}var D=n.description;/\S/.test(D)||(D=null);var I={name:s,value:Polimapper.numberWithCommas(y),nationalAverages:w,displayRanking:x,currency:Polimapper.decodeHtml(c),icons:u.reverse(),color:l,escapedName:Polimapper.toSlug(s),multivalued:n.isMultivalued,label:m,description:D,hide_empty_valu_on_node:n.hide_empty_valu_on_node,node:Polimapper.data.topology.labelForSingularNode};d>1e6?(T=Polimapper.templates["src/templates/bigNumberNode.handlebars"],textTemplate=Polimapper.templates["src/templates/numberTextNode.handlebars"]):(T=Polimapper.templates["src/templates/numberNode.handlebars"],textTemplate=Polimapper.templates["src/templates/numberTextNode.handlebars"],d=Polimapper.numberWithCommas(d));var A=T(I),F=textTemplate(I);if(e("#data .results .icon").remove(),e("#data .results .result").attr("class","result result_graph graph-text"),"0"!==n.parentId?e("#data .results").append('<div class="node-children children'+n.parentId+'">'+F+"</div>"):!0===n.isGroup?(e("#data .results").append('<div class="node-group group'+i[p+1].parentId+'">'+F+"</div>"),e(".node-group .result").attr("class","main-g-h"),e(".node-group .graph-text-inr").attr("class",""),e(".node-group .n").attr("class","new-g-heading")):e("#data .results").append(F),e(".main-g-h .v").remove(),e(".main-g-h .mytooltip").remove(),e(".main-g-h .nationalaverage").remove(),e(".main-g-h .displayranking").remove(),e(".graph-wrapper").append('<div class="col-md-6 graph-data"><div class="card">'+A+"</div></div>"),n.includeAverageInNodeGraphs){var N="";g="";for(_=0;_<n.columns.length;_++)N=n.averageOverride?N+","+parseInt(n.columns[_].averageOverride).toFixed(2):N+","+parseInt(n.columns[_].average).toFixed(2),g=g+","+n.columns[_].label;N=Polimapper.parseValueStrings(N),g=Polimapper.parseValueStrings(g),n.isMultivalued||(g[0]=Polimapper.data.topology.labelForSingularNode);t(a.name),Polimapper.hexToRgba(l,60)}else t(a.name),Polimapper.hexToRgba(l,60);e(".pretty-number").removeAttr("data-pretty-number"),e(".pretty-number").prettyNumber();break;case"Percentage":w="",C="";"Pound"===n.type&&(C="&#163; "),"Dollar"===n.type&&(C="&#36; "),"Euro"===n.type&&(C="&#128; ");k="";if("Percentage"===n.type&&(k="%"),n.includeAverageInNodeGraphs){for(_=0;_<n.columns.length;_++)w=n.averageOverride?w+","+Number(n.columns[_].averageOverride).toFixed(2):w+","+Number(n.columns[_].average).toFixed(2);w=Polimapper.parseValueStrings(w),w=(w=parseFloat(w)).toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),w=Polimapper.decodeHtml(C)+w+" "+k}x="";if(n.columns[0].displayRankings){S=null;S=n.columns[0].invertRankings?Polimapper.orderNodesByColumnValue(n.name,n.columns[0].name).reverse():Polimapper.orderNodesByColumnValue(n.name,n.columns[0].name),x="#"+(Polimapper.arrayRankingLookup(S,n.name,n.columns[0].name,a.columnValue(n.name,n.columns[0].name))+1)}D=n.description;if(/\S/.test(D)||(D=null),n.isMultivalued)Polimapper.drawMultivalueBarChart(a,n,s,l,m);else{d=a.columnValue(s,s),A=(T=Polimapper.templates["src/templates/percentageNode.handlebars"])(I={name:s,value:d,nationalAverages:w,displayRanking:x,icon:n.columns[0].icon,hide_empty_valu_on_node:n.hide_empty_valu_on_node,label:m,description:D});e("#data .results .icon").remove(),e("#data .results .result").attr("class","result result_graph graph-text"),"0"!==n.parentId?e("#data .results").append('<div class="node-children children'+n.parentId+'">'+A+"</div>"):!0===n.isGroup?(e("#data .results").append('<div class="node-group group'+i[p+1].parentId+'">'+A+"</div>"),e(".node-group .result").attr("class","main-g-h"),e(".node-group .graph-text-inr").attr("class",""),e(".node-group .n").attr("class","new-g-heading")):e("#data .results").append(A),e(".main-g-h .v").remove(),e(".main-g-h .mytooltip").remove(),e(".main-g-h .nationalaverage").remove(),e(".main-g-h .displayranking").remove(),e(".graph-wrapper").append('<div class="col-md-6 graph-data"><div class="card">'+A+"</div></div>")}break;case"Hyperlink":w="",C="";"Pound"===n.type&&(C="&#163; "),"Dollar"===n.type&&(C="&#36; "),"Euro"===n.type&&(C="&#128; ");k="";if("Percentage"===n.type&&(k="%"),n.includeAverageInNodeGraphs){for(_=0;_<n.columns.length;_++)w=n.averageOverride?w+","+Number(n.columns[_].averageOverride).toFixed(2):w+","+Number(n.columns[_].average).toFixed(2);w=Polimapper.parseValueStrings(w),w=(w=parseFloat(w)).toString().replace(/\B(?=(\d{3})+(?!\d))/g,","),w=Polimapper.decodeHtml(C)+w+" "+k}x="";if(n.columns[0].displayRankings){S=null;S=n.columns[0].invertRankings?Polimapper.orderNodesByColumnValue(n.name,n.columns[0].name).reverse():Polimapper.orderNodesByColumnValue(n.name,n.columns[0].name),x="#"+(Polimapper.arrayRankingLookup(S,n.name,n.columns[0].name,a.columnValue(n.name,n.columns[0].name))+1)}var M=a.columnValue(s,s),V=""==trim(n.link_text)?"Click here":n.link_text;if(M){var T=Polimapper.templates["src/templates/link.handlebars"],z=M.split(":::");A=T(I={name:s,url:z[0],nationalAverages:w,displayRanking:x,text:z[1],icon:n.columns[0].icon,link_text:V,label:m});e("#data .results .icon").remove(),e("#data .results .result").attr("class","result result_graph graph-text"),"0"!==n.parentId?e("#data .results").append('<div class="node-children children'+n.parentId+'">'+A+"</div>"):!0===n.isGroup?(e("#data .results").append('<div class="node-group group'+i[p+1].parentId+'">'+A+"</div>"),e(".node-group .result").attr("class","main-g-h"),e(".node-group .graph-text-inr").attr("class",""),e(".node-group .n").attr("class","new-g-heading")):e("#data .results").append(A),e(".main-g-h .v").remove(),e(".main-g-h .mytooltip").remove(),e(".main-g-h .nationalaverage").remove(),e(".main-g-h .displayranking").remove(),e(".graph-wrapper").append('<div class="col-md-6 graph-data"><div class="card">'+A+"</div></div>")}break;case"Text":default:M=a.columnValue(s,s),T=Polimapper.templates["src/templates/text.handlebars"],Polimapper.templates["src/templates/textMobile.handlebars"],D=n.description;/\S/.test(D)||(D=null);A=T(I={name:s,value:M,nationalAverages:w="",displayRanking:x="",description:D,icon:n.columns[0].icon,escapedName:Polimapper.toSlug(s),hide_empty_valu_on_node:n.hide_empty_valu_on_node,label:m});e("#data .results .icon").remove(),e("#data .results .result").attr("class","result result_graph graph-text"),"0"!==n.parentId?e("#data .results").append('<div class="node-children children'+n.parentId+'">'+A+"</div>"):!0===n.isGroup?(e("#data .results").append('<div class="node-group group'+i[p+1].parentId+'">'+A+"</div>"),e(".node-group .result").attr("class","main-g-h"),e(".node-group .graph-text-inr").attr("class",""),e(".node-group .n").attr("class","new-g-heading")):e("#data .results").append(A),e(".main-g-h .v").remove(),e(".main-g-h .mytooltip").remove(),e(".main-g-h .nationalaverage").remove(),e(".main-g-h .displayranking").remove(),e(".graph-wrapper").append('<div class="col-md-6 graph-data"><div class="card">'+A+"</div></div>")}}}!function(e){e.fn.moveTo=function(a){return this.each(function(){var o=e(this).clone();e(o).appendTo(a),e(this).remove()})}}(jQuery);for(p=0;p<i.length;p++)!0===i[p].isGroup&&e(".children"+i[p+1].parentId).moveTo(".group"+i[p+1].parentId);e(".node-group").each(function(){e(this).find(".node-children").wrapAll('<div class="new-div-wrapper"><div class="new-div"></div></div>')})},Polimapper.drawMultivalueBarChart=function(a,l,r,i,p){var n=a.columnValue(r,r),s="",m="",d="";l.columns.forEach(function(e,o){var t=a.column(l.name,e.name);d=d+","+e.label,s=s+","+e.icon,t.value&&(m=m+","+t.value,o===l.columns.length-1&&parseFloat(t.value))}),m=Polimapper.parseValueStrings(m),d=Polimapper.parseValueStrings(d),s=Polimapper.parseValueStrings(s),n>1e6?template=Polimapper.templates["src/templates/bigNumber.handlebars"]:(template=Polimapper.templates["src/templates/number.handlebars"],n=Polimapper.numberWithCommas(n)),""===s&&(s=[]);var c=l.description;/\S/.test(c)||(c=null);var u,h={name:r,value:n,color:i,escapedName:Polimapper.toSlug(r),icons:s.reverse(),multivalued:l.isMultivalued,hide_empty_valu_on_node:l.hide_empty_valu_on_node,label:p,description:c,showGraph:!0},g=template(h);if(e("#data .results").append(g),l.includeAverageInNodeGraphs){var v="";d="";for(var y=0;y<l.columns.length;y++)v=l.averageOverride?v+","+parseInt(l.columns[y].averageOverride).toFixed(2):v+","+parseInt(l.columns[y].average).toFixed(2),d=d+","+l.columns[y].name;v=Polimapper.parseValueStrings(v),u={labels:d=Polimapper.parseValueStrings(d),datasets:[{label:t(a.name),fillColor:Polimapper.hexToRgba(i,60),strokeColor:i,highlightFill:i,highlightStroke:i,pointColor:"#ffffff",pointStrokeColor:i,pointHighlightFill:i,pointHighlightStroke:"#ffffff",data:m},{label:"Average",fillColor:"rgba(220,220,220,0.5)",strokeColor:"rgba(220,220,220,0.8)",highlightFill:"rgba(220,220,220,0.75)",highlightStroke:"rgba(220,220,220,1)",data:v}]}}else u={labels:d,datasets:[{label:t(a.name),fillColor:Polimapper.hexToRgba(i,60),strokeColor:i,highlightFill:i,highlightStroke:i,data:m}]};var P=e("#"+Polimapper.toSlug(r)).get(0).getContext("2d");new o(P).Bar(u,{responsive:!0,labelLength:30,multiTooltipTemplate:"<%if (datasetLabel){%><%=datasetLabel %>:  <%}%><%= Polimapper.addCommas(value) %>"})},Polimapper.drawMultivalueSummaryBarChart=function(a,t,l){var r,i="",p="",n="",s="",m="",d="";a.columns.forEach(function(e){d=d+","+e.label,n=n+","+e.maxValue,s=s+","+e.minValue,m=m+","+(e.averageOverride?parseInt(e.averageOverride).toFixed(2):parseInt(e.average).toFixed(2)),p=p+","+e.icon}),n=Polimapper.parseValueStrings(n),s=Polimapper.parseValueStrings(s),m=Polimapper.parseValueStrings(m),d=Polimapper.parseValueStrings(d),p=Polimapper.parseValueStrings(p);var c="";a.excludeMinFromDataSetSummaryGraph||(c+='<div class="legend-item"><span style="background-color:'+Polimapper.data.keyColour4+';"></span> Min</div>'),a.excludeAverageFromDataSetSummaryGraph||(c+='<div class="legend-item"><span style="background-color:'+Polimapper.data.keyColour3+';"></span> Avg</div>'),a.excludeMaxFromDataSetSummaryGraph||(c+='<div class="legend-item"><span style="background-color:'+Polimapper.data.keyColour1+';"></span> Max</div>'),r=Polimapper.templates["src/templates/number.handlebars"],i=Polimapper.numberWithCommas(i),""===p&&(p=[]);var u=a.description;/\S/.test(u)||(u=null);var h=r({name:a.name,value:i,currency:"",icons:p.reverse(),escapedName:Polimapper.toSlug(a.name),multivalued:a.isMultivalued,hide_empty_valu_on_node:a.hide_empty_valu_on_node,label:l,description:u,legend:""!==c,legendHtml:c,showGraph:!0});e("#data .totals").append(h);var g={label:"Min",fillColor:Polimapper.hexToRgba(Polimapper.data.keyColour4,20),strokeColor:Polimapper.data.keyColour4,highlightFill:Polimapper.data.keyColour4,highlightStroke:"rgba(220,220,220,1)",pointColor:Polimapper.data.keyColour4,pointStrokeColor:Polimapper.data.keyColour4,pointHighlightFill:Polimapper.data.keyColour4,pointHighlightStroke:"rgba(220,220,220,1)",data:s},v={label:"Avg",fillColor:Polimapper.hexToRgba(Polimapper.data.keyColour3,20),strokeColor:Polimapper.data.keyColour3,highlightFill:Polimapper.data.keyColour3,pointColor:Polimapper.data.keyColour3,pointStrokeColor:Polimapper.data.keyColour3,pointHighlightFill:Polimapper.data.keyColour3,pointHighlightStroke:"rgba(220,220,220,1)",data:m},y={label:"Max",fillColor:Polimapper.hexToRgba(Polimapper.data.keyColour1,20),strokeColor:Polimapper.data.keyColour1,highlightFill:Polimapper.data.keyColour1,pointColor:Polimapper.data.keyColour1,pointStrokeColor:Polimapper.data.keyColour1,pointHighlightFill:Polimapper.data.keyColour1,pointHighlightStroke:"rgba(220,220,220,1)",data:n},P=[];a.excludeMinFromDataSetSummaryGraph||P.push(g),a.excludeAverageFromDataSetSummaryGraph||P.push(v),a.excludeMaxFromDataSetSummaryGraph||P.push(y);var f={labels:d,datasets:P},b=e("#"+Polimapper.toSlug(t)).get(0).getContext("2d");new o(b).Bar(f,{responsive:!0,labelLength:30,multiTooltipTemplate:"<%if (datasetLabel){%><%=datasetLabel %>:  <%}%><%= Polimapper.addCommas(value) %>"})},Polimapper.setLocalData=function(e,a){if(window.sessionStorage)try{window.sessionStorage.setItem(e,JSON.stringify(a))}catch(o){console.log("Error in local storage",o),window.sessionStorage.setItem(e,JSON.stringify(a))}},Polimapper.getLocalData=function(e){return window.sessionStorage?JSON.parse(window.sessionStorage.getItem(e)):null},Polimapper.setsessionStorageData=function(e,a){if(window.sessionStorage)try{window.sessionStorage.setItem(e,JSON.stringify(a))}catch(o){console.log("Error in local storage",o),window.sessionStorage.setItem(e,JSON.stringify(a))}},Polimapper.getsessionStorageData=function(e){return window.sessionStorage?JSON.parse(window.sessionStorage.getItem(e)):null},Polimapper.summaryData=function(){var a=Polimapper.orderDatafields(Polimapper.data.dataFields);Polimapper.setPageTitle(Polimapper.data.title),e("#data .totals .result").remove(),e(".graph-wrapper").html("");for(var t=0;t<a.length;t++){var l=a[t],r=l.name,i=l.columns[0].label?l.columns[0].label:l.name;if(l.showAverageInDataSetSummary||l.showTotalInDataSetSummary){l.average=l.average||0,l.totalValue=l.totalValue||0;var p="",n=l.averageOverride?l.averageOverride:parseInt(l.average).toFixed(2),s=parseInt(l.totalValue).toFixed(2),m="",d=null;switch(l.type){case"Pound":case"Euro":case"Dollar":case"Decimal":case"Number":var c,u=parseFloat(s);"Pound"===l.type&&(p="&#163; "),"Dollar"===l.type&&(p="&#36; "),"Euro"===l.type&&(p="&#128; ");var h="",g="",v="",y="",P=0,f="";l.columns.forEach(function(e,a){y=y+","+e.label,h=h+","+e.maxValue,g=g+","+e.minValue,e.average=e.average||0,e.totalValue=e.totalValue||0,v=v+","+(e.averageOverride?parseInt(e.averageOverride).toFixed(2):parseInt(e.average).toFixed(2)),f=f+","+e.icon,a===l.columns.length-1&&(P+=e.totalValue)}),h=Polimapper.parseValueStrings(h),g=Polimapper.parseValueStrings(g),v=Polimapper.parseValueStrings(v),y=Polimapper.parseValueStrings(y),f=Polimapper.parseValueStrings(f),l.excludeMinFromDataSetSummaryGraph||(m+='<div class="legend-item"><span style="background-color:'+Polimapper.data.keyColour4+';"></span> Min</div>'),l.excludeAverageFromDataSetSummaryGraph||(m+='<div class="legend-item"><span style="background-color:'+Polimapper.data.keyColour3+';"></span> Avg</div>'),l.excludeMaxFromDataSetSummaryGraph||(m+='<div class="legend-item"><span style="background-color:'+Polimapper.data.keyColour1+';"></span> Max</div>'),l.isMultivalued?u=parseFloat(parseInt(P).toFixed(2)):y[0]="",l.showTotalInDataSetSummary||(u=""),u>1e6?c=Polimapper.templates["src/templates/bigNumber.handlebars"]:(c=Polimapper.templates["src/templates/number.handlebars"],u=Polimapper.numberWithCommas(u));var b=l.description;/\S/.test(b)||(b=null),l.showAverageInDataSetSummary?d=b:(m=null,escapedName=null,d=null),""===f&&(f=[]);var w=c({name:l.name,value:u,currency:Polimapper.decodeHtml(p),icons:f.reverse(),escapedName:Polimapper.toSlug(l.name),multivalued:l.isMultivalued,label:i,description:d,total:l.showTotalInDataSetSummary,hide_empty_valu_on_node:l.hide_empty_valu_on_node,legend:""!==m,legendHtml:m,showGraph:l.showAverageInDataSetSummary});e(".graph-wrapper").append('<div class="col-md-6 graph-data"><div class="card">'+w+"</div></div>");var C={label:"Min",fillColor:Polimapper.hexToRgba(Polimapper.data.keyColour4,20),strokeColor:Polimapper.data.keyColour4,highlightFill:Polimapper.data.keyColour4,highlightStroke:"rgba(220,220,220,1)",pointColor:Polimapper.data.keyColour4,pointStrokeColor:Polimapper.data.keyColour4,pointHighlightFill:Polimapper.data.keyColour4,pointHighlightStroke:"rgba(220,220,220,1)",data:g},k={label:"Avg",fillColor:Polimapper.hexToRgba(Polimapper.data.keyColour3,20),strokeColor:Polimapper.data.keyColour3,highlightFill:Polimapper.data.keyColour3,pointColor:Polimapper.data.keyColour3,pointStrokeColor:Polimapper.data.keyColour3,pointHighlightFill:Polimapper.data.keyColour3,pointHighlightStroke:"rgba(220,220,220,1)",data:v},_={label:"Max",fillColor:Polimapper.hexToRgba(Polimapper.data.keyColour1,20),strokeColor:Polimapper.data.keyColour1,highlightFill:Polimapper.data.keyColour1,pointColor:Polimapper.data.keyColour1,pointStrokeColor:Polimapper.data.keyColour1,pointHighlightFill:Polimapper.data.keyColour1,pointHighlightStroke:"rgba(220,220,220,1)",data:h},x=[];if(l.excludeMinFromDataSetSummaryGraph||x.push(C),l.excludeAverageFromDataSetSummaryGraph||x.push(k),l.excludeMaxFromDataSetSummaryGraph||x.push(_),l.showAverageInDataSetSummary){var S={labels:y,datasets:x},D=e("#"+Polimapper.toSlug(r)).get(0).getContext("2d");"Bar"!==l.graphType&&l.isMultivalued?new o(D).Line(S,{responsive:!0,labelLength:30,tooltipTemplate:"<%if (label){%><%=label %>:  <%}%><%= Polimapper.addCommas(value) %>",multiTooltipTemplate:"<%if (datasetLabel){%><%=datasetLabel %>:  <%}%><%= Polimapper.addCommas(value) %>"}):new o(D).Bar(S,{responsive:!0,labelLength:30,tooltipTemplate:"<%if (label){%><%=label %>:  <%}%><%= Polimapper.addCommas(value) %>",multiTooltipTemplate:"<%if (datasetLabel){%><%=datasetLabel %>:  <%}%><%= Polimapper.addCommas(value) %>"})}e(".pretty-number").removeAttr("data-pretty-number"),e(".pretty-number").prettyNumber();break;case"Percentage":if(l.showAverageInDataSetSummary||l.showTotalInDataSetSummary)if(l.isMultivalued)Polimapper.drawMultivalueSummaryBarChart(l,r,i);else{var I=Polimapper.templates["src/templates/percentage.handlebars"];b=l.description;/\S/.test(b)||(b=null);var A=I({name:l.name,value:n,icon:l.icon,escapedName:Polimapper.toSlug(l.name),label:i,description:b,showGraph:l.showAverageInDataSetSummary});e("#data .totals").append(A);var F=[{value:n,color:Polimapper.data.keyColour1,highlight:"#FF5A5E",label:"Average"},{value:100-n,color:"#f1f1f1",highlight:"#f1f1f1",label:""}];if(l.showAverageInDataSetSummary){var N=e("#"+Polimapper.toSlug(r)).get(0).getContext("2d");new o(N).Doughnut(F,{animateScale:!0,labelLength:30,segmentShowStroke:!1})}}}}}},Polimapper.addCommas=function(e){x=(e+="").split("."),x1=x[0],x2=x.length>1?"."+x[1]:"";for(var a=/(\d+)(\d{3})/;a.test(x1);)x1=x1.replace(a,"$1,$2");return x1+x2},Polimapper.parseValueStrings=function(e){return","==e.substring(0,1)&&(e=e.substring(1).split(",")),e},Polimapper.orderDatafields=function(e){for(var o=a.sortBy(e,function(e){return[e.parentId,e.isGroup,e.sequence_no]}),t=0;t<o.length;++t)o[t].columns=a.sortBy(o[t].columns,function(e){return e.columnIndex});return o},Polimapper.orderDatafields2=function(e){var o;return o=a.filter(e,function(e){return"Number"===e.type}),o=a.union(o,a.filter(e,function(e){return"Decimal"===e.type})),o=a.union(o,a.filter(e,function(e){return"Pound"===e.type})),o=a.union(o,a.filter(e,function(e){return"Euro"===e.type})),o=a.union(o,a.filter(e,function(e){return"Dollar"===e.type})),o=a.union(o,a.filter(e,function(e){return"Percentage"===e.type})),o=a.union(o,a.filter(e,function(e){return"Text"===e.type})),o=a.union(o,a.filter(e,function(e){return"Hyperlink"===e.type}))},Polimapper.orderNodesByColumnValue=function(e,o){return a.sortBy(Polimapper.data.nodes,function(a){return isNaN(parseFloat(a.columnValue(e,o)))?null:parseFloat(a.columnValue(e,o))}).reverse()},Polimapper.loadRankingIcons=function(o){var t=a.filter(Polimapper.data.dataFields,function(e){return e.comparable&&"Text"!==e.type}),l=!1;e("#ranking_title")[0].innerHTML="";for(var r=0;r<t.length;++r){var i=t[r],p=i.columns.length-1,n=i.columns[p],s=(o.columnValue(i.name,n.name),null);Polimapper.data.nodes.length;if(null!==o.columnValue(i.name,n.name)&&n.displayRankings){l||(l=!0),s=n.invertRankings?Polimapper.orderNodesByColumnValue(i.name,n.name).reverse():Polimapper.orderNodesByColumnValue(i.name,n.name);var m=Polimapper.arrayRankingLookup(s,i.name,n.name,o.columnValue(i.name,n.name))+1;(0,Polimapper.templates["src/templates/rankings.handlebars"])({name:n.name,fieldName:i.name,icon:n.icon,ranking:m})}}e("#rankings .icon").bind("mouseover",function(a){e("#cons_name_overlay").empty().append(e(this).data("name")),e(".showmap").is(":visible")?(e("#cons_name_overlay").css("left",a.pageX-50),e("#cons_name_overlay").css("top",a.pageY+20)):(e("#cons_name_overlay").css("left",a.pageX-50),e("#cons_name_overlay").css("top",a.pageY-20))}),e("#rankings .icon").bind(" mouseenter",function(){e("#cons_name_overlay").show()}).mouseleave(function(){e("#cons_name_overlay").hide()})}}(Polimapper.$||window.$,Polimapper._||window._,Polimapper.Chart||window.Chart),window.Polimapper||(Polimapper={}),function(e,a){Polimapper.loadScript=function(e){null!==e&&postscribe(document.getElementsByTagName("body")[0],e)},Polimapper.arrayLookup=function(e,a,o){for(var t=0,l=e.length;t<l;t++)if(e[t][a]===o)return e[t]},Polimapper.arrayIndexLookup=function(e,a,o){for(var t=0,l=e.length;t<l;t++)if(e[t][a]===o)return t},Polimapper.arrayRankingLookup=function(e,a,o,t){for(var l=0,r=e.length;l<r;l++)if(e[l].columnValue(a,o)===t)return l},Polimapper.toSlug=function(e){return e.toLowerCase().replace(/[^\w ]+/g,"").replace(/ +/g,"-")},Polimapper.getUrlVariable=function(e){for(var a=window.location.search.substring(1).split("&"),o=0;o<a.length;o++){var t=a[o].split("=");if(t[0]==e)return t[1]}return!1},Polimapper.getUrlVariableEnhanced=function(e){for(var a=window.location.pathname.split("/"),o=0;o<a.length;o++)return a[1];return!1},Polimapper.getHashParams=function(){for(var e,a={},o=/\+/g,t=/([^&;=]+)=?([^&;]*)/g,l=function(e){return decodeURIComponent(e.replace(o," "))},r=window.location.hash.substring(1);e=t.exec(r);)a[l(e[1])]=l(e[2]);return a},Polimapper.getHashParam=function(e){return Polimapper.getHashParams()[e]},Polimapper.setHashParam=function(e,a){var o=Polimapper.getHashParams();o[e]=a;var t="#";for(var l in o)o.hasOwnProperty(l)&&("#"!==t&&(t+="&"),t+=l+"="+encodeURIComponent(o[l]));window.location.hash=t},Polimapper.isMobile=function(){return e(".polimapper-mobile").is(":visible")},Polimapper.isResizeMobile=function(){return 0===e.trim(e(".polimapper-mobile").html()).length&&e(".polimapper-mobile").is(":visible")},Polimapper.isResizeDesktop=function(){return 0===e.trim(e(".polimapper-desktop").html()).length&&e(".polimapper-desktop").is(":visible")},Polimapper.decodeHtml=function(e){var a=document.createElement("textarea");return a.innerHTML=e,a.value},Polimapper.hexToRgba=function(e,a){return e=e.replace("#",""),r=parseInt(e.substring(0,2),16),g=parseInt(e.substring(2,4),16),b=parseInt(e.substring(4,6),16),result="rgba("+r+","+g+","+b+","+a/100+")",result},Polimapper.numberWithCommas=function(e){if(!e)return e;var a=e.toString().split(".");return a[0].replace(/\B(?=(\d{3})+(?!\d))/g,",")+(a[1]?"."+a[1]:"")},Polimapper.equalHeight=function(e,a){var o=document.getElementsByClassName(a),t=[],l=0;if(!0===e)for(l=0;l<o.length;l++)o[l].style.height="auto";for(l=0;l<o.length;l++){var r=o[l].clientHeight;t.push(r)}for(l=0;l<o.length;l++)o[l].style.height=Math.max.apply(Math,t)+"px",!1===e&&(o[l].className=o[l].className+" show")},SVGElement.prototype.hasClass=function(e){return new RegExp("(\\s|^)"+e+"(\\s|$)").test(this.getAttribute("class"))},SVGElement.prototype.addClass=function(e){this.hasClass(e)||this.setAttribute("class",this.getAttribute("class")+" "+e)},SVGElement.prototype.removeClass=function(e){var a=this.getAttribute("class").replace(new RegExp("(\\s|^)"+e+"(\\s|$)","g"),"$2");this.hasClass(e)&&this.setAttribute("class",a)},SVGElement.prototype.toggleClass=function(e){this.hasClass(e)?this.removeClass(e):this.addClass(e)},Polimapper.addClass=function(e,a){var o=(e.getAttribute("class")||"").replace(a,"");e.setAttribute("class",o+(o?" ":"")+a)},Polimapper.removeClass=function(e,a){var o=e.getAttribute("class");e.setAttribute("class",(o||"").replace(a,""))},Element.prototype.remove=function(){this.parentElement.removeChild(this)},NodeList.prototype.remove=HTMLCollection.prototype.remove=function(){for(var e=this.length-1;e>=0;e--)this[e]&&this[e].parentElement&&this[e].parentElement.removeChild(this[e])}}(Polimapper.$||window.$,Polimapper._||window._),window.Polimapper||(Polimapper={}),function(e,a){Polimapper.setMapDetails=function(){(Polimapper.setPageTitle(Polimapper.data.title),document.getElementsByClassName("loading").remove(),e("body").removeClass("fixed-body"),e(".node-description-wraper").hide(),e(".node-intro-wraper").hide(),e("#name").empty().html(Polimapper.data.title),e("#print-pro-name").empty().html(Polimapper.data.title),e("#description").empty().html(Polimapper.data.description),e("#mailprivacypolicy").empty().html(Polimapper.data.privacypolicy)," "!=Polimapper.data.nodeDescription&&"<div><br></div>"!==Polimapper.data.nodeDescription&&""!=Polimapper.data.nodeDescription&&null!=Polimapper.data.nodeDescription&&"<br>"!==Polimapper.data.nodeDescription||" "!=Polimapper.data.printDescription&&"<div><br></div>"!==Polimapper.data.printDescription&&""!=Polimapper.data.printDescription&&null!=Polimapper.data.printDescription&&"<br>"!==Polimapper.data.printDescription||e(".node-description-wraper").remove(),e(".node_description").empty().html(Polimapper.data.nodeDescription),e(".print_description").empty().html(Polimapper.data.printDescription),e(".node_intro").empty().html(Polimapper.data.node_intro),/\S/.test(Polimapper.data.nodeDescription)||/\S/.test(Polimapper.data.printDescription)||e(".node-description-wraper").remove(),Polimapper.data.node_intro)?Polimapper.data.node_intro.replace(/<(.|\n)*?>/g,"")||e(".node-intro-wraper").remove():e(".node-intro-wraper").remove();if(e("#logo").attr("src",Polimapper.data.logo),e("#logo-mobile").attr("src",Polimapper.data.logo),e(".footer-desc").empty().html(Polimapper.data.footerContent),e("#project_password").val(Polimapper.data.project_status.password),e("#project_key").val(Polimapper.data.key),e(".node-view-charts").hide(),!0===Polimapper.data.hideBranding&&e(".footer-logo").parent().remove(),!0===Polimapper.data.isGroup){document.getElementById("select_group").onchange=function(){var a=window.location.origin,o=e("#select_group").val();window.location.href=a+"?"+o,localStorage.setItem("selectedGroup",o)};for(var a=0;a<Polimapper.data.grouplinks.length;a++){if(e("#select_group").append("<option value='"+Polimapper.data.grouplinks[a].url+"'>"+Polimapper.data.grouplinks[a].name+"</option>"),localStorage.getItem("selectedGroup"))Polimapper.data.grouplinks.find(({url:e})=>e===localStorage.getItem("selectedGroup"))&&e("#select_group").val(localStorage.getItem("selectedGroup"))}}else e(".group-dropdown").remove();if(!1!==Polimapper.data.socialShare?(!1!==Polimapper.data.sociallinksarray[0].enable?null!==Polimapper.data.sociallinksarray[0].text&&e("#is_facebook").val(Polimapper.data.sociallinksarray[0].text.replaceAll("{map title}",Polimapper.data.title)):e("#is_facebook_modal").remove(),!1!==Polimapper.data.sociallinksarray[3].enable?null!==Polimapper.data.sociallinksarray[3].text&&e("#is_linkedin").val(Polimapper.data.sociallinksarray[3].text.replaceAll("{map title}",Polimapper.data.title)):e("#is_linkedin_modal").remove(),!1!==Polimapper.data.sociallinksarray[2].enable?null!==Polimapper.data.sociallinksarray[2].text&&e("#is_twitter").val(Polimapper.data.sociallinksarray[2].text.replaceAll("{map title}",Polimapper.data.title)):e("#is_twitter_modal").remove()):(e("#is_linkedin_modal").remove(),e("#is_twitter_modal").remove(),e("#is_facebook_modal").remove()),"yes"!=Polimapper.data.pdfDownload&&e("#printPDF").remove(),"yes"!=Polimapper.data.imageExport&&e("#export_png").remove(),"8"===Polimapper.data.topology.mapID||"19"===Polimapper.data.topology.mapID||e(".modal-map-legend").remove(),!1!==Polimapper.data.emailFriend){var o=Polimapper.data.emailFriendTitle;e("#email_friend_title").val(o);var t=Polimapper.data.emailFriendCody;e("#email_friend_text").empty().html(t)}else e("#is_email_friend").remove();0==Polimapper.data.sociallinksarray[0].enable&&0==Polimapper.data.sociallinksarray[3].enable&&0==Polimapper.data.sociallinksarray[2].enable&&0==Polimapper.data.emailFriend&&e(".mob-toggle").remove(),!1!==Polimapper.data.emailMP?e("#email_mp_sub").val(Polimapper.data.emailMPTitle.replaceAll("{map title}",Polimapper.data.title)):e("#email_mp_share").remove(),!1!==Polimapper.data.tweetMP||(e("#email_mp_tweet").remove(),e("#not_on_twitter").remove()),0==Polimapper.data.tweetMP&&0==Polimapper.data.emailMP&&e(".legend-desc").remove(),Polimapper.data.topology.mapID,document.getElementById("sel_con").onchange=function(){e(".constituency-view #data_selector").hide(),e(".Nodechart").show(),e(".Nationalchart").hide()},e("#sel_con").on("change",function(){var a=e("#sel_con").val(),o=Polimapper.getLocalData("nodes").find(({name:e})=>e===a);if("8"==Polimapper.data.topology.mapID||"19"==Polimapper.data.topology.mapID);else{var t="";o.mpdetails={email:"",fname:t,lname:"",party:"",prefix:"",profile_url:"",twitter_handle:""}}if(o&&o.mpdetails&&o.mpdetails.fname)t=o.mpdetails.fname;else t="{first name}";var l=Polimapper.data.emailMPMessage.replaceAll("{first name}",t),r=Polimapper.data.title;l=(l=l.replaceAll("{nodename}",a)).replaceAll("{map title}",r);var i=Polimapper.data.nodeDescription,p=Polimapper.data.node_intro;if(i&&(i=i.replaceAll("{first name}",t)),p&&(p=p.replaceAll("{first name}",t)),o.data){var n=o.data;for(let e=0;e<Polimapper.data.dataFieldsArray.length;e++){var s="{"+Polimapper.data.dataFieldsArray[e]+"}",m=Polimapper.data.dataFieldsArray[e],d=n.find(({name:e})=>e===m),c="";if(d){c=d.value?d.value:" ",l=(l=l.replaceAll(s,c)).replaceAll(s.toLowerCase(),c);var u=Polimapper.data.dataFieldsArray[e],h=Polimapper.data.dataFields;if(void 0==(g=h.find(({unique_name:e})=>e===u))){u=u.replace(/\s+/g," ").trim();var g=h.find(({unique_name:e})=>e===u)}var v="";g&&(v=Number(g.average).toFixed(2));var y="";if(g){var P=Polimapper.arrayLookup(Polimapper.data.nodes,"name",a),f=null;f=g.columns[0].invertRankings?Polimapper.orderNodesByColumnValue(g.name,g.columns[0].name).reverse():Polimapper.orderNodesByColumnValue(g.name,g.columns[0].name),y="#"+(Polimapper.arrayRankingLookup(f,g.name,g.columns[0].name,P.columnValue(g.name,g.columns[0].name))+1)}var b="{"+Polimapper.data.dataFieldsArray[e]+" #average}",w="{"+Polimapper.data.dataFieldsArray[e]+" #ranking}",C="{"+Polimapper.data.dataFieldsArray[e]+" Average}",k="{"+Polimapper.data.dataFieldsArray[e]+" Ranking}";i&&(i=(i=(i=(i=(i=(i=(i=(i=(i=(i=i.replaceAll(s,c)).replaceAll(s.toLowerCase(),c)).replaceAll(b,v)).replaceAll(b.toLowerCase(),v)).replaceAll(C,v)).replaceAll(C.toLowerCase(),v)).replaceAll(w,y)).replaceAll(w.toLowerCase(),y)).replaceAll(k,y)).replaceAll(k.toLowerCase(),y)),p&&(p=(p=(p=(p=(p=(p=(p=(p=(p=(p=p.replaceAll(s,c)).replaceAll(s.toLowerCase(),c)).replaceAll(b,v)).replaceAll(b.toLowerCase(),v)).replaceAll(C,v)).replaceAll(C.toLowerCase(),v)).replaceAll(w,y)).replaceAll(w.toLowerCase(),y)).replaceAll(k,y)).replaceAll(k.toLowerCase(),y))}}}l=l.replaceAll("{nodename}",a),i&&(i=(i=(i=i.replaceAll("{nodename}",a)).replaceAll("{map title}",r)).replaceAll("{mpname}",o.mpdetails.fname+" "+o.mpdetails.lname)),p&&(p=(p=(p=p.replaceAll("{nodename}",a)).replaceAll("{map title}",r)).replaceAll("{mpname}",o.mpdetails.fname+" "+o.mpdetails.lname)),e("#email_mp_message").empty().html(l),e("#email_mp_message").val(l),e("#mp_name").empty().html(o.mpdetails.fname+" "+o.mpdetails.lname),e("#mp_profile_url").attr("href",o.mpdetails.profile_url),e("#mp_email").val(o.mpdetails.email),e(".node_description").empty().html(i),e(".node_intro").empty().html(p),"NOT ON TWITTER"==o.mpdetails.twitter_handle.replaceAll("\r\n","").toUpperCase()?(e("#email_mp_tweet").hide(),e("#not_on_twitter").show(),e("#not_on_twitter").empty().html(o.mpdetails.twitter_handle)):(e("#not_on_twitter").hide(),e("#email_mp_tweet").show(),e("#mp_twitter_id").val(o.mpdetails.twitter_handle))}),e("#sel_con").select2({}),e(document).ready(function(){e(".mob-toggle").click(function(a){a.stopPropagation(),e(".mob-share").toggleClass("mob-share-open"),e("body").click(function(){e(".mob-share").removeClass("mob-share-open")})}),e(".select-wrapper").click(function(a){a.stopPropagation(),e(this).toggleClass("select-open"),e("#data_con").slideToggle(),e("#data_con li span").click(function(){e(".select-wrapper").removeClass("select-open"),e(".select-wrapper > p").text(e(this).text()),e("#data_con").hide()}),e("body").click(function(){e(".select-wrapper").removeClass("select-open"),e("#data_con").hide()})})}),!Polimapper.data.dataFields.length>0&&e("#data_selector").remove(),e("#data_con").click(function(){var a=e("#datafieldselectedValue").text();e("#c_field").html(a);var o=Polimapper.data.dataFields.find(({name:e})=>e===a);e(".map-key").empty(),e("#defaultcolor").remove(),e("#onchangecolor").remove();var t=o.keyColors.length;if(css='<style id="onchangecolor" class="mapcolors" type="text/css">',"Text"==o.type)for(var l=0;l<t;l++)e(".map-key").append('<div class="map-val"><div class="bar" style="background:'+o.keyColors[l].keyColor+' !important;"></div><span id="pn'+(l+1)+'" class="pretty-number"></span></div>'),css=css+".keyColour"+(l+1)+"{fill: "+o.keyColors[l].keyColor+"; }",e("#pn"+(l+1)).empty().text(o.keyColors[l].MaxDisplayKey);else for(l=0;l<t;l++){if(e(".map-key").append('<div class="map-val"><div class="bar" style="background:'+o.keyColors[l].keyColor+' !important;"></div><span id="pn'+(l+1)+'" class="pretty-number"></span></div>'),css=css+".keyColour"+(l+1)+"{fill: "+o.keyColors[l].keyColor+"; }",/[^a-zA-Z0-9.+-,\-_/\/]/.test(o.keyColors[l].MaxDisplayKey)||/[^a-zA-Z0-9.+-,\-_/\/]/.test(o.keyColors[l].MinDisplayKey))var r=o.keyColors[l].MinDisplayKey?o.keyColors[l].MinDisplayKey:null,i=o.keyColors[l].MaxDisplayKey?o.keyColors[l].MaxDisplayKey:null;else r=o.keyColors[l].MinDisplayKey?Polimapper.prettyPrintNumber(o.keyColors[l].MinDisplayKey):null,i=o.keyColors[l].MaxDisplayKey?Polimapper.prettyPrintNumber(o.keyColors[l].MaxDisplayKey):null;0===l?"Equal Count"==o.rangeType?e("#pn"+(l+1)).empty().html(r+" - "+i):1==o.show_last_key?e("#pn"+(l+1)).empty().html(r+" - "+i):e("#pn"+(l+1)).empty().text(r+"+"):e("#pn"+(l+1)).empty().html(r+" - "+i)}e("html > head").append(L),o.map_areas_border_colour=null==o.map_areas_border_colour?"#646464":o.map_areas_border_colour,css=css+nodesParam+" { stroke: "+o.map_areas_border_colour+" !important; stroke-width: "+stokeWidth+";  stroke-linejoin: round;}",css+="100%);}</style>",e(document.body).prepend(e(css)),e(".map-key").append('<div class="map-val"><div class="bar" style="background:#dedede !important;"></div><span id="nodata" class="pretty-number">Data unavailable</span></div>')});var l=Polimapper.data.key;function r(e){for(var a=e+"=",o=decodeURIComponent(document.cookie).split(";"),t=0;t<o.length;t++){for(var l=o[t];" "==l.charAt(0);)l=l.substring(1);if(0==l.indexOf(a))return l.substring(a.length,l.length)}return""}""!=r("is_viewed_"+l)&&1==r("is_viewed_"+l)||(urlnew=Polimapper.baseUrl+"/generator/projectviewcount.php",e.ajax({type:"POST",url:urlnew,data:{viewcount:1,key:l},success:function(e){!function(e,a,o){var t=new Date;t.setTime(t.getTime()+24*o*60*60*1e3);var l="expires="+t.toGMTString();document.cookie=e+"="+a+";"+l+";path=/"}("is_viewed_"+l,1,1)},error:function(e){console.log(e)}})),e(".svg_wrapper svg").dblclick(function(){var a=e("#cons_name_overlay").html(),o=Polimapper.getLocalData("nodes").find(({name:e})=>e===a);void 0===o?(e("#undefined").show(),e("#undefined").html(a+" is not found.").fadeOut(4e3)):(e("#undefined").hide(),e("#sel_con").val(o.name).change(),e(".closes").show())}),e(".map-key").empty();var i=[];for(a=0;a<Polimapper.data.dataFields.length;a++)if("true"===Polimapper.data.dataFields[a].comparable&&!1===Polimapper.data.dataFields[a].isGroup){i.push(Polimapper.data.dataFields[a]);break}if(i[0]){var p=i[0].name;Polimapper.paintMap(p,p),e("#datafieldselectedValue").html(p);var n=i[0].keyColors.length;if(css='<style type="text/css">',e("#c_field").hide(),e("#c_field").html(p),"Text"==i[0].type)for(a=0;a<n;a++)e(".map-key").append('<div class="map-val"><div class="bar" style="background:'+i[0].keyColors[a].keyColor+' !important;"></div><span id="pn'+(a+1)+'" class="pretty-number"></span></div>'),css=css+".keyColour"+(a+1)+"{fill: "+i[0].keyColors[a].keyColor+"; }",e("#pn"+(a+1)).empty().text(i[0].keyColors[a].MaxDisplayKey);else for(a=0;a<n;a++){if(e(".map-key").append('<div class="map-val"><div class="bar" style="background:'+i[0].keyColors[a].keyColor+' !important;"></div><span id="pn'+(a+1)+'" class="pretty-number"></span></div>'),css=css+".keyColour"+(a+1)+"{fill: "+i[0].keyColors[a].keyColor+"; }",/[^a-zA-Z0-9.+-,\-_/\/]/.test(i[0].keyColors[a].MaxDisplayKey)||/[^a-zA-Z0-9.+-,\-_/\/]/.test(i[0].keyColors[a].MinDisplayKey))var s=i[0].keyColors[a].MinDisplayKey?i[0].keyColors[a].MinDisplayKey:null,m=i[0].keyColors[a].MaxDisplayKey?i[0].keyColors[a].MaxDisplayKey:null;else s=i[0].keyColors[a].MinDisplayKey?Polimapper.prettyPrintNumber(i[0].keyColors[a].MinDisplayKey):null,m=i[0].keyColors[a].MaxDisplayKey?Polimapper.prettyPrintNumber(i[0].keyColors[a].MaxDisplayKey):null;0===a?"Equal Count"==i[0].rangeType?e("#pn"+(a+1)).empty().html(s+" - "+m):1==i[0].show_last_key?e("#pn"+(a+1)).empty().html(s+" - "+m):e("#pn"+(a+1)).empty().text(s+"+"):e("#pn"+(a+1)).empty().html(s+" - "+m)}css+="100%);}</style>"}e(".map-key").append('<div class="map-val"><div class="bar" style="background:#dedede !important;"></div><span id="nodata" class="pretty-number">Data unavailable</span></div>');var d=localStorage.getItem("passKey"),c=localStorage.getItem("projectKey");"draft"==Polimapper.data.project_status.visibility?(e(".polimapper").remove(),e(".protected-project").empty().html('<div class="draft-project"><h2>'+Polimapper.data.title+" is in draft.</h2>")):!0===Polimapper.data.project_status.password_protected&&(d==Polimapper.data.project_status.password&&c==Polimapper.data.key||null!==Polimapper.data.project_status.password&&(e(".polimapper").remove(),e(".protected-project").empty().html('<div class="protected-form"><div><div class="form-fields"><form><input type="password" id="input_password" value="" autocomplete="off" placeholder="Enter your project password"></form><button id="password_verify" onclick="verifyPass()">Verify</button></div><span id="password_error"></span></div></div>'),e(document).ready(function(){document.getElementById("input_password").addEventListener("keypress",function(e){"Enter"===e.key&&(e.preventDefault(),document.getElementById("password_verify").click())})}))),e(".closes").on("click",function(){Polimapper.setPageTitle(Polimapper.data.title),e("#data .results").empty().append("<div class='totals'><h2 id='name'></h2><div id='description'> </div></div>"),e("#name").empty().html(Polimapper.data.title),e("#description").empty().html(Polimapper.data.description),e("#data_selector").show(),"Area"==Polimapper.data.topology.labelForSingularNode||"Authority"==Polimapper.data.topology.labelForSingularNode?e("#sel_con").select2({placeholder:"Enter an "+Polimapper.data.topology.labelForSingularNode}):e("#sel_con").select2({placeholder:"Enter a "+Polimapper.data.topology.labelForSingularNode}),e("span.select2").css({color:Polimapper.data.secondaryColour,background:Polimapper.data.primaryColour}),e("body .select2-selection__arrow b").append('<svg xmlns="http://www.w3.org/2000/svg" width="67" height="67" viewBox="0 0 67 67"><path d="M33.5,0A33.5,33.5,0,1,1,0,33.5,33.5,33.5,0,0,1,33.5,0ZM29.53,21.054a9.277,9.277,0,0,0-9.5,9,9.27,9.27,0,0,0,9.5,9,9.27,9.27,0,0,0,9.5-9,9.281,9.281,0,0,0-9.5-9ZM49.464,50.947h0a2.492,2.492,0,0,1-1.7-.672l-9.593-8.953a14.2,14.2,0,0,1-8.391,2.732l-.245,0-.245,0a14.257,14.257,0,0,1-14.254-14,14.257,14.257,0,0,1,14.254-14l.245,0h0l.246,0a14.257,14.257,0,0,1,14.253,14,14.176,14.176,0,0,1-2.4,7.662l9.544,8.9a2.5,2.5,0,0,1-1.706,4.327h0Z" fill-rule="evenodd"/></svg>'),e("body .select2-selection__arrow b svg path").css({fill:Polimapper.data.secondaryColour});var a=window.location.href.split("#")[0];setTimeout(function(){history.replaceState("",null,a)},1),e(".Nodechart").hide(),e(".Nationalchart").show()});var u=Polimapper.getUrlVariable("download");u&&"true"==u&&setTimeout(()=>{svgtopngdownload()},800);for(var h=0;h<Polimapper.data.chartWizard.length;h++)if("National"==Polimapper.data.chartWizard[h].graph_for){var g=Polimapper.data.chartWizard[h].chart_name.replaceAll(" ","-"),v=Polimapper.data.chartWizard[h].graph_for+"chart";"full_width"==Polimapper.data.chartWizard[h].map_width?e(".national_view_wrapper").append("<div class="+v+" style='width:100%;'><div class='chart-wizard'><canvas id="+g+"></canvas></div></div>"):e(".national_view_wrapper").append("<div class="+v+" style='width:50%;'><div class='chart-wizard'><canvas id="+g+"></canvas></div></div>")}var y=[],P=[],f=[],b=[];if(Polimapper.data.chartWizard.length>0)for(var w=0;w<Polimapper.data.chartWizard.length;w++)if("National"==Polimapper.data.chartWizard[w].graph_for){g=Polimapper.data.chartWizard[w].chart_name.replaceAll(" ","-");var C=Polimapper.data.chartWizard[w].display_name,k=Polimapper.data.chartWizard[w].x_axis_title,_=Polimapper.data.chartWizard[w].y_axis_title,x=Polimapper.data.chartWizard[w].average_color;if("National"==Polimapper.data.chartWizard[w].graph_for)var S=!0;else S=!1;var D=Polimapper.data.chartWizard[w].graph_type.toLowerCase();"bar"==D&&(D="horizontalBar"),"column"==D&&(D="bar"),"donut"==D&&(D="doughnut");var I="-1",A=[],F=[],N=[];for(h=0;h<Polimapper.data.chartWizard[w].columns.length;h++){if("line"==D&&(I=!1),"pie"==D||"doughnut"==D)var M=Polimapper.data.chartWizard[w].columns[h].label;else if("horizontalBar"==D)M=Polimapper.data.chartWizard[w].columns[h].label.match(/.{1,25}(\s|$)/g);else M=Polimapper.data.chartWizard[w].columns[h].label.match(/.{1,18}(\s|$)/g);if(y.push(M),P.push(Polimapper.data.chartWizard[w].columns[h].average),f.push(Polimapper.data.chartWizard[w].columns[h].totalValue),b.push(Polimapper.data.chartWizard[w].columns[h].field_color),piedata={label:M,tension:.1,backgroundColor:[Polimapper.data.primaryColour,Polimapper.data.secondaryColour],data:[Polimapper.data.chartWizard[w].columns[h].average,Polimapper.data.chartWizard[w].columns[h].totalValue]},A.push(piedata),"pie"==D||"doughnut"==D){var V=Polimapper.data.chartWizard[w].columns[h].totalValue;F.push(V);var T=Polimapper.data.chartWizard[w].columns[h].field_color;N.push(T)}}if("pie"==D||"doughnut"==D)var z=[{label:"Total",data:F,backgroundColor:N}];else z=[{label:"Total",tension:0,pointDot:!0,fill:!1,borderWidth:1,borderColor:Polimapper.data.primaryColour,backgroundColor:Polimapper.data.primaryColour,data:f},{label:"Average",tension:0,fill:I,pointDot:!0,borderWidth:1,borderColor:x,backgroundColor:x,data:P}];var W=document.getElementById(g).getContext("2d");if("pie"==D||"doughnut"==D)var B={maintainAspectRatio:!1,responsive:!0,fullWidth:1,showAllTooltips:S,tooltips:{callbacks:{title:function(e){return e[0].label},label:function(e,a){return a.datasets[e.datasetIndex].label},footer:function(e,a){e=e[0];var o=a.datasets[e.datasetIndex].data[e.index];return a.labels[e.index]+" : "+o}},displayColors:!1,yAlign:"bottom"},maintainAspectRatio:!1,title:{display:!0,text:C,fontSize:25,fontColor:"#000"},legend:{position:"bottom"}};else if("horizontalBar"==D)B={maintainAspectRatio:!1,responsive:!0,fullWidth:1,showAllTooltips:S,tooltips:{callbacks:{title:function(){},label:function(e,a){return e.xLabel}},displayColors:!1,yAlign:"bottom"},title:{display:!0,text:C,fontSize:25,fontColor:"#000"},legend:{position:"bottom"},scales:{yAxes:[{ticks:{beginAtZero:!0,autoSkip:!1}}],xAxes:[{ticks:{beginAtZero:!0,autoSkip:!1}}]}};else B={maintainAspectRatio:!1,responsive:!0,fullWidth:1,showAllTooltips:S,tooltips:{callbacks:{title:function(){},label:function(e,a){return a.datasets[e.datasetIndex].data[e.index]}},displayColors:!1,yAlign:"bottom"},title:{display:!0,text:C,fontSize:25,fontColor:"#000"},legend:{position:"bottom"},scales:{yAxes:[{scaleLabel:{display:!0,fontSize:20,fontColor:"#000",labelString:_},ticks:{beginAtZero:!0,autoSkip:!1}}],xAxes:[{scaleLabel:{display:!0,fontSize:20,fontColor:"#000",labelString:k},ticks:{beginAtZero:!0,autoSkip:!1}}]},animation:{duration:0}};new Chart(W,{type:D,data:{labels:y,datasets:z},options:B});y=[],P=[],f=[],b=[]}var L=e("<style>.sbm-modal-title h2, .sbm-modal-title div h2, .sbm-modal-title p, .sbm-modal-1 .modal-right-content p, .sbm-modal-1-form .form-field, .form-field, .results #description, .results #description h2, .sbm-modal-title h2, .sbm-modal-title div h2, .sbm-modal-title p, .sbm-modal-1 .modal-right-content p, .results .totals #name , .modal-map-legend .link-bio a { color: "+Polimapper.data.textColour3+" !important;}  </style>");e("html > head").append(L);L=e("<style>.mytooltip svg path { fill: "+Polimapper.data.secondaryColour+" !important}  </style>");e("html > head").append(L);L=e("<style>.results .nationalaverage, .results .displayranking, .results .node-group:after { background: "+Polimapper.data.secondaryColour+" !important}  </style>");e("html > head").append(L);L=e("<style>  .footer-desc, .node_description, .node_intro, .print_description, .select2-container .select2-selection--single .select2-selection__rendered, .sbm-btn-white, .sbm-btn, .new-g-heading, .polimapper .closes.cus-close a { color: "+Polimapper.data.textColour1+" !important}  </style>");e("html > head").append(L);L=e("<style>  a.hyperLinknode, a.hyperLinknode:hover { background-color: "+Polimapper.data.textColour1+" !important; color: "+Polimapper.data.textColour2+" !important}  </style>");e("html > head").append(L);L=e("<style>.results .nationalaverage, .results .nationalaverage b, .results .displayranking, .results .displayranking b  { color: "+Polimapper.data.textColour2+" !important}  </style>");e("html > head").append(L);L=e("<style> span.select2, span.select2, .results .result .n, .results .result .n span, .results .result .v, .results .result .v span  { color: "+Polimapper.data.textColour1+" !important;}  </style>");if(e("html > head").append(L),Polimapper.data.dataFields.length>0){Polimapper.data.dataFields[0].map_areas_border_colour=null==Polimapper.data.dataFields[0].map_areas_border_colour?"#646464":Polimapper.data.dataFields[0].map_areas_border_colour,nodesParamEx=".postcode, .uk-region, .european",stokeWidth="5vw",["27"].includes(Polimapper.data.topology.mapID)&&(stokeWidth=".4vw"),["17","18","30","5","12","19","26","4","16","20","15","10","1","9","11"].includes(Polimapper.data.topology.mapID)&&(stokeWidth=".2vw"),["5","13","25","14","22","7"].includes(Polimapper.data.topology.mapID)&&(stokeWidth="2vw"),["8"].includes(Polimapper.data.topology.mapID)&&(stokeWidth="0"),"3"==Polimapper.data.topology.mapID&&(stokeWidth="10vw"),"6"==Polimapper.data.topology.mapID&&(stokeWidth="1vw"),"27"==Polimapper.data.topology.mapID&&e(".svg_wrapper").addClass("ROI"),nodesParam="svg.pz:not("+nodesParamEx+") > g:hover path, svg.pz"+nodesParamEx+" path:hover";L=e('<style id="nodeBorderColour"> '+nodesParam+"  { stroke: "+Polimapper.data.dataFields[0].map_areas_border_colour+" !important; stroke-width: "+stokeWidth+";  stroke-linejoin: round;}  </style>");e("html > head").append(L),e("svg.pz:not(.uk-constituency) > g:hover path, svg.pz.uk-constituency path:hover").css({stroke:Polimapper.data.primaryColour,"stroke-width":stokeWidth,"stroke-linejoin":"round"})}e(".polimapper .app_wrapper .map-section .map-option .buttons span svg path, .print svg path, .select-wrapper svg path").css({fill:Polimapper.data.secondaryColour}),e("input#postcode, .graph-section.footer-area *, .node-description-wraper, .protected-form button, span.select2, .node-description-wraper, .node-intro-wraper").css({color:Polimapper.data.secondaryColour}),e(".custom-topbar .postcodea .icon-wrapper").css({"border-color":Polimapper.data.secondaryColour}),e("body .select2-selection__arrow b").append('<svg xmlns="http://www.w3.org/2000/svg" width="67" height="67" viewBox="0 0 67 67"><path d="M33.5,0A33.5,33.5,0,1,1,0,33.5,33.5,33.5,0,0,1,33.5,0ZM29.53,21.054a9.277,9.277,0,0,0-9.5,9,9.27,9.27,0,0,0,9.5,9,9.27,9.27,0,0,0,9.5-9,9.281,9.281,0,0,0-9.5-9ZM49.464,50.947h0a2.492,2.492,0,0,1-1.7-.672l-9.593-8.953a14.2,14.2,0,0,1-8.391,2.732l-.245,0-.245,0a14.257,14.257,0,0,1-14.254-14,14.257,14.257,0,0,1,14.254-14l.245,0h0l.246,0a14.257,14.257,0,0,1,14.253,14,14.176,14.176,0,0,1-2.4,7.662l9.544,8.9a2.5,2.5,0,0,1-1.706,4.327h0Z" fill-rule="evenodd"/></svg>'),e("body .select2-selection__arrow b svg path").css({fill:Polimapper.data.secondaryColour}),e("#name, #description, select#sel_con,.graph-section.footer-area, .polimapper .searchbox select, .polimapper div.app_wrapper div.data .results h3.n, .polimapper div.app_wrapper div.data .results h3, .protected-form input, .polimapper div.app_wrapper div.data h2.con_name").css({color:Polimapper.data.primaryColour}),e(".modal-map-legend .left-box, .sbm-modal-1-form, .sbm-btn-white, .sbm-btn, .protected-form button, .node-description-wraper, .node-intro-wraper").css({background:Polimapper.data.primaryColour}),e(".sbm-modal-1-form .form-field, .form-field, .sbm-btn-white, .sbm-btn, .bordered-box-1, .protected-form button, .protected-form input, .mob-toggle").css({"border-color":Polimapper.data.primaryColour}),e(".legend-desc p, .legend-desc a").css({color:Polimapper.data.secondaryColour}),e(".legend-desc p.mp-name").css({color:Polimapper.data.primaryColour}),e(".legend-desc").css({"border-color":Polimapper.data.primaryColour});L=e("<style> .polimapper .lightbox svg path  { fill: "+Polimapper.data.primaryColour+" !important;}  </style>");e("html > head").append(L);var G;L=e("<style> span.zoom-out, span.zoom-in, .graph-section.footer-area, #postcode, .graph-section, .polimapper .closes.cus-close, .select2-container--default, #email_mp_share, p#email_mp_tweet  { background-color: "+Polimapper.data.primaryColour+" !important;}  </style>");e("html > head").append(L),e(".social a svg path, .mob-toggle svg path, .polimapper .close path, #select_group").css({fill:Polimapper.data.primaryColour}),G=Polimapper.data.fontFamily,Polimapper.data.fontFamily,"google"!=G.font_type?e("head").append("<link href='"+Polimapper.baseUrl+"/"+G.importLink+"' rel='stylesheet' type='text/css'>"):e("head").append("<link href='https://fonts.googleapis.com/css?family="+G.font_family+"' rel='stylesheet' type='text/css'>"),e(".polimapper, .polimapper .app_wrapper, .polimapper .content-wrapper .showmap, .autocomplete-suggestions,   .footer-take-over, .polimapper, .polimapper a, .polimapper select, .polimapper button, .polimapper input, .polimapper textarea, .polimapper div.topbar h2#name, .polimapper div.app_wrapper div.map .dtfield h2, .polimapper div.app_wrapper div.map .dtfield h2, .polimapper div.app_wrapper div.map div.options div.text .select-wrapper select, .polimapper div.app_wrapper div.data .results, .polimapper div.app_wrapper div.data .results p.description, .polimapper div.app_wrapper div.data .copy p, .polimapper .searchbox input, .polimapper .searchbox select, .polimapper .lightbox h3, .polimapper .modal-dialog, #select2-sel_con-results .select2-results__option, .select2-container, body").css("font-family",G.font_family+", sans-serif"),e(".logo-sec .logo").attr("src",Polimapper.data.logo),Polimapper.setOGImage()},Polimapper.setPageTitle=function(e){Polimapper.embedded||(document.title=e),addthis_share.title=e},Polimapper.setOGImage=function(){Polimapper.embedded||(e("meta[property=og\\:image]").attr("content",Polimapper.data.logo),e("head").append('<meta property="og:title" content="'+Polimapper.data.title+'" />'))},Polimapper.displayNodeFromUrl=function(){if(window.location.hash&&window.location.hash.split("=")[1]){var a=decodeURIComponent(window.location.hash.split("=")[1]),o=e("path[data-name='"+a+"']").get(0);o&&Polimapper.drawNode(o)}},Polimapper.insertDesktopLayout=function(){var a=(0,Polimapper.templates["src/templates/desktopLayout.handlebars"])({resourcePrefix:Polimapper.resourcePrefix||""});"localhost"===location.hostname||"127.0.0.1"===location.hostname?loc="tt":loc="front-end/",Polimapper.loc=loc,Polimapper.container?e("#"+Polimapper.container).prepend(a):e(".polimapper-desktop").prepend(a)},Polimapper.insertMobileLayout=function(){var a=(0,Polimapper.templates["src/templates/mobileLayout.handlebars"])({resourcePrefix:Polimapper.resourcePrefix||""});Polimapper.container?e("#"+Polimapper.container).prepend(a):e(".polimapper-mobile").prepend(a)},Polimapper.insertUkConstituencyMap=function(a,o){"localhost"===location.hostname||"127.0.0.1"===location.hostname?loc="":loc="front-end/";var t=(Polimapper.resourcePrefix||"")+loc+"html/"+a;e(".svg_wrapper").load(t,o)},Polimapper.chartFuntion=function(e,a,o,t,l,r){new Chart(e,{type:a,data:o,options:t})},Polimapper.drawNode=function(a){if(a){var o;if(o=a.cloneNode?a.cloneNode():a,("greater-london"==e(a).parent().attr("id")||"west-midlands"==e(a).parent().attr("id"))&&!o.hasClass("done")){var t=e(o).attr("d").split(/z/i)[1];e(o).attr("d",t+"z"),Polimapper.addClass(o,"done")}o.removeAttr?o.removeAttr("transform"):o.removeAttribute?o.removeAttribute("transform"):(o=e(o).clone()).removeAttr("transform"),e("#ov_c").empty(),e("#ov_c").append(o).html(),e("#con_name").innerHTML=e(o).attr("data-name"),e("#rankings").empty(),Polimapper.setPageTitle(e(o).attr("data-name")+"- "+Polimapper.data.title),addthis_share.url=window.location.href,Polimapper.setHashParam("con_over",e(o).data("name")),e("#con_over").show(),e(".closes").show(),e(".app_wrapper").addClass("constituency-view"),e(".constituency-view #data, .constituency-view .map").removeClass("col-md-6"),e(".constituency-view #data").addClass("col-md-8"),e(".constituency-view .map").addClass("col-md-4"),e(".results").attr("style","background: "+Polimapper.data.primaryColour+" !important; font-family:"+Polimapper.data.fontFamily.font_family+", sans-serif"),Polimapper.loadNodeData(e(o).data("name"));var l=-1*Math.floor(o.getBBox().x),r=-1*Math.floor(o.getBBox().y),i=o.getBBox().height,p=o.getBBox().width;if(e(".map").length){var n=.45*e(".map")[0].clientHeight,s=.9*e(".map")[0].clientWidth,m=n/i,d=s/p,c=Math.min(m,d);l+=(s-p*c)/2/c,e("#ov_c").attr("transform","scale("+(c||0)+") translate("+(l||0)+" "+(r||0)+")")}}},Polimapper.paintMap=function(a,o){if(o){o=String(o);var t=Polimapper.arrayLookup(Polimapper.data.dataFields,"name",a);Polimapper.arrayLookup(t.columns,"name",o);if("Text"===t.type)Polimapper.textGrouping(a,o);else if(t.groupingMethod)switch(t.groupingMethod){case"Percentiles":Polimapper.percentilesGrouping(a,o);break;case"EqualRanges":default:Polimapper.equalRangesGrouping(a,o)}else Polimapper.percentilesGrouping(a,o);Polimapper.maindata=e("#data .results").html()}},Polimapper.setColors=function(o){var t='<style type="text/css">.fi {fill: '+o.keyColour1+"; }";t=(t=(t=t+".se {fill: "+o.keyColour2+"; }")+".th {fill: "+o.keyColour3+"; }")+".fo {fill: "+o.keyColour4+"; }",e(document.body).prepend(e(t));Polimapper.isMobile(),t='<style id="defaultcolor" class="mapcolors" type="text/css">';Polimapper.data.numberOfKeyColours,Polimapper.data.dataFields,a.filter(Polimapper.orderDatafields(Polimapper.data.dataFields),function(e){return e.comparable});for(var l=[],r=0;r<Polimapper.data.dataFields.length;r++)"true"===Polimapper.data.dataFields[r].comparable&&!1===Polimapper.data.dataFields[r].isGroup&&l.push(Polimapper.data.dataFields[r]);if(l[0]){var i=l[0].keyColors.length;for(r=0;r<i;r++)t=t+".keyColour"+(r+1)+"{fill: "+l[0].keyColors[r].keyColor+"; }"}return t+="100%);}</style>",e(document.body).prepend(e(t)),setTimeout(()=>{window.parent.postMessage({message:"getAppData",Height:e("body").height(),value:"test val"},"*")},2e3),!1}}(Polimapper.$||window.$,Polimapper._||window._),window.Polimapper||(Polimapper={}),function(e,a){Polimapper.equalRangesGrouping=function(o,t){for(var l=Polimapper.arrayLookup(Polimapper.data.dataFields,"name",o),r=Polimapper.arrayLookup(l.columns,"name",t),i=Polimapper.data.nodes,p=[],n=0,s=i.length;n<s;n++){var m=i[n].columnValue(o,r.name);p=p.concat(m&&m.toLowerCase().trim())}for(var d=a.uniq(a.without(p,"",null)),c={},u=function(e){var a=e.columnValue(o,t);return a&&a.toLowerCase()===d[h]},h=0,g=d.length;h<g;h++){var v=a.countBy(i,u);c[d[h]]=v.true}var y=[];Object.keys(c).forEach(function(e){y.push({label:e,count:c[e]})});a.sortBy(y,"count").reverse();e(".lt").empty().text(""),e("#q"+(d.length+1)).empty().html("unknown");Math.round(i.length/l.keyColors.length),Math.round(i.length/l.keyColors.length);for(var P=0,f=i.length;P<f;P++)for(var b=e("path[data-name='"+i[P].name+"']"),w=0;w<b.length;w++){var C=b[w],k=i[P].columnValue(o,t);if(k=k&&k.toLowerCase(),C){if(Polimapper.removeClass(C,"null"),Polimapper.removeClass(C,"keyColourNull"),Polimapper.removeClass(C,"keyColour1"),Polimapper.removeClass(C,"keyColour2"),Polimapper.removeClass(C,"keyColour3"),Polimapper.removeClass(C,"keyColour4"),Polimapper.removeClass(C,"keyColour5"),Polimapper.removeClass(C,"keyColour6"),Polimapper.removeClass(C,"keyColour7"),Polimapper.removeClass(C,"keyColour8"),Polimapper.removeClass(C,"keyColour9"),Polimapper.removeClass(C,"keyColour10"),l.keyColors[0])var _=l.keyColors[0].minKeyValue.replaceAll(",",""),x=Number(_.replace("+",""));if(null===k)Polimapper.addClass(C,"keyColourNull");else if(k>=x)Polimapper.addClass(C,"keyColour1");else{var S=l.keyColors.length;for(n=1;n<S;n++)k>=Number(l.keyColors[n].minKeyValue.replaceAll(",",""))&&k<=Number(l.keyColors[n].MaxKeyValue.replaceAll(",",""))&&Polimapper.addClass(C,"keyColour"+(n+1))}}}},Polimapper.percentilesGrouping=function(o,t){for(var l=Polimapper.arrayLookup(Polimapper.data.dataFields,"name",o),r=Polimapper.arrayLookup(l.columns,"name",t),i=Polimapper.data.nodes,p=[],n=0,s=i.length;n<s;n++){var m=i[n].columnValue(o,r.name);p=p.concat(m&&m.toLowerCase().trim())}for(var d=a.uniq(a.without(p,"",null)),c={},u=function(e){var a=e.columnValue(o,t);return a&&a.toLowerCase()===d[h]},h=0,g=d.length;h<g;h++){var v=a.countBy(i,u);c[d[h]]=v.true}var y=[];Object.keys(c).forEach(function(e){y.push({label:e,count:c[e]})});a.sortBy(y,"count").reverse();e(".lt").empty().text(""),e("#q"+(d.length+1)).empty().html("unknown");Math.round(i.length/l.keyColors.length),Math.round(i.length/l.keyColors.length);for(var P=0,f=i.length;P<f;P++)for(var b=e("path[data-name='"+i[P].name+"']"),w=0;w<b.length;w++){var C=b[w],k=i[P].columnValue(o,t);if(k=k&&k.toLowerCase(),C){if(Polimapper.removeClass(C,"null"),Polimapper.removeClass(C,"keyColourNull"),Polimapper.removeClass(C,"keyColour1"),Polimapper.removeClass(C,"keyColour2"),Polimapper.removeClass(C,"keyColour3"),Polimapper.removeClass(C,"keyColour4"),Polimapper.removeClass(C,"keyColour5"),Polimapper.removeClass(C,"keyColour6"),Polimapper.removeClass(C,"keyColour7"),Polimapper.removeClass(C,"keyColour8"),Polimapper.removeClass(C,"keyColour9"),Polimapper.removeClass(C,"keyColour10"),l.keyColors[0])var _=l.keyColors[0].minKeyValue.replaceAll(",",""),x=Number(_.replace("+",""));if(null===k)Polimapper.addClass(C,"keyColourNull");else if(k>=x)Polimapper.addClass(C,"keyColour1");else{var S=l.keyColors.length;for(n=1;n<S;n++)k>=Number(l.keyColors[n].minKeyValue.replaceAll(",",""))&&k<=Number(l.keyColors[n].MaxKeyValue.replaceAll(",",""))&&Polimapper.addClass(C,"keyColour"+(n+1))}}}},Polimapper.textGrouping=function(o,t){for(var l=Polimapper.arrayLookup(Polimapper.data.dataFields,"name",o),r=Polimapper.arrayLookup(l.columns,"name",t),i=Polimapper.data.nodes,p=[],n=0,s=i.length;n<s;n++){var m=i[n].columnValue(o,r.name);p=p.concat(m&&m.toLowerCase().trim())}for(var d=a.uniq(a.without(p,"",null)),c={},u=function(e){var a=e.columnValue(o,t);return a&&a.toLowerCase()===d[h]},h=0,g=d.length;h<g;h++){var v=a.countBy(i,u);c[d[h]]=v.true}var y=[];Object.keys(c).forEach(function(e){y.push({label:e,count:c[e]})});a.sortBy(y,"count").reverse();e(".lt").empty().text(""),e("#q"+(d.length+1)).empty().html("unknown");for(var P=0,f=i.length;P<f;P++)for(var b=e("path[data-name='"+i[P].name+"']"),w=0;w<b.length;w++){var C=b[w],k=i[P].columnValue(o,t);if(k&&null!=k&&(k=k.replace(/\s+/g," ").trim()),C){Polimapper.removeClass(C,"null"),Polimapper.removeClass(C,"keyColourNull"),Polimapper.removeClass(C,"keyColour1"),Polimapper.removeClass(C,"keyColour2"),Polimapper.removeClass(C,"keyColour3"),Polimapper.removeClass(C,"keyColour4"),Polimapper.removeClass(C,"keyColour5"),Polimapper.removeClass(C,"keyColour6"),Polimapper.removeClass(C,"keyColour7"),Polimapper.removeClass(C,"keyColour8"),Polimapper.removeClass(C,"keyColour9"),Polimapper.removeClass(C,"keyColour10"),null===k&&Polimapper.addClass(C,"keyColourNull"),Polimapper.addClass(C,"keyColourNull");var _=l.keyColors.length;for(n=0;n<_;n++)k==l.keyColors[n].MaxKeyValue&&(Polimapper.removeClass(C,"keyColourNull"),Polimapper.addClass(C,"keyColour"+(n+1)))}}},Polimapper.prettyPrintNumber=function(e){if(e){var a,o=e.replaceAll(",",""),t=parseInt(o),l="";if(isNaN(t)||!isFinite(t))a="N/A";else{var r=t;r<1e3?l="":r<1e6?(l="K",r/=1e3):r<1e9?(l="M",r/=1e6):r<1e12?(l="B",r/=1e9):r<1e15?(l="T",r/=1e12):r>1e15&&(l="Q",r/=1e12);var i=1;""===l?(i=2,a=o=o.replaceAll("+",""),a+=l):(a=parseFloat(r.toFixed(i)),a+=l),a=a.replaceAll(".00","")}return a}},Polimapper.prettyPrintNumberDecimal=function(e){var a,o="";if(isNaN(e)||!isFinite(e))a="N/A";else{var t=parseFloat(e);t<1e3?o="":t<1e6?(o="K",t/=1e3):t<1e9?(o="M",t/=1e6):t<1e12?(o="B",t/=1e9):t<1e15&&(o="T",t/=1e12);var l=1;""===o&&(l=3),a=parseFloat(t.toFixed(l)),a+=o}return a}}(Polimapper.$||window.$,Polimapper._||window._),window.Polimapper||(Polimapper={}),function(e,a){Polimapper.FieldData=function(e,a){this.name=e,this.columns=a},Polimapper.ColumnData=function(e,a,o){this.field=e,this.name=a,this.value=o},Polimapper.Node=function(e){var o=this,t=e;this.name=t.name;var l=[],r=[];a.keys(t.data).forEach(function(e){var o=t.data[e],i=[],p=new Polimapper.FieldData(e,i);a.keys(o).forEach(function(e){var a=o[e],t=new Polimapper.ColumnData(p,e,a);i.push(t),r.push(t)}),l.push(p)}),this.column=function(e,o){return a.find(r,function(a){return a.field.name===e&&a.name===o})},this.columnValue=function(e,a){var t=o.column(e,a);return t?t.value:null},this.field=function(e){return a.findWhere(l,{name:e})},this.columns=function(){return r},this.fields=function(){return l},this.forEachColumn=function(e){r.forEach(e)},this.forEachField=function(e){l.forEach(e)}}}(Polimapper.$||window.$,Polimapper._||window._),function(e){var a={DIV:function(e){o(e)},SPAN:function(e){o(e)},A:function(e){o(e)}};function o(e){var a=e.text();!function(e,a,o){var t;a&&a.length>0&&!isNaN(a)&&!e.data("pretty-number")&&(t=Polimapper.prettyPrintNumberDecimal(a),e.attr("data-pretty-number",a),e.attr("title",a));o&&o(t)}(e,a,function(a){a&&e.text(a)})}e.fn.prettyNumber=function(){return this.each(function(){var o=e(this);a[this.tagName]&&a[this.tagName](o)})}}(Polimapper.$||window.$),window.Polimapper||(Polimapper={}),function(e,a,o){function t(a,o,t,l,r){document.body;var p=window.innerHeight;function n(a){e(".chart-value.max",a).animate({width:t.getBarWidth}),e(".chart-value.avg",a).animate({width:l.getBarWidth}),e(".chart-value.min",a).animate({width:r.getBarWidth})}function s(a){e(".chart-value.max",a).animate({height:t.getBarWidth}),e(".chart-value.avg",a).animate({height:l.getBarWidth}),e(".chart-value.min",a).animate({height:r.getBarWidth})}if(a.length>0){var m=a[0];m.getBoundingClientRect().bottom<p?n(m):i(m,n)}if(o.length>0){var d=o[0];d.getBoundingClientRect().bottom<p?s(d):i(d,s)}}function l(a,o,t){document.body;var l=window.innerHeight;function r(a){e(".chart-value.avg",a).animate({height:o.getBarWidth}),e(".chart-value.node",a).animate({height:t.getBarWidth})}(a=a[0]).getBoundingClientRect().bottom<l?r(a):i(a,r)}function r(a,o,t){document.body;var l=window.innerHeight;function r(a){e(".chart-value.avg",a).animate({width:o.getBarWidth}),e(".chart-value.node",a).animate({width:t.getBarWidth})}(a=a[0]).getBoundingClientRect().bottom<l?r(a):i(a,r)}function i(a,o){var t=window.innerHeight;e(document).scroll(function l(){a.getBoundingClientRect().top<t/2&&(e(document).off("scroll",l),o(a))})}function p(e,a){var o,t=e.toString().split(".")[0].length,l=1;for(o=1;o<t;o++)l*=10;return t=Math.ceil(e/l)*l}Polimapper.mobileSummaryData=function(){var a=Polimapper.orderDatafields(Polimapper.data.dataFields);Polimapper.setPageTitle(Polimapper.data.title),e("#data .totals .result").remove();for(var o=0;o<a.length;o++){var l=a[o],r=l.name,i=l.columns[0].label?l.columns[0].label:l.name;if(l.showAverageInDataSetSummary||l.showTotalInDataSetSummary){l.average=l.average||0,l.totalValue=l.totalValue||0;var n="",s=l.averageOverride?l.averageOverride:l.average.toFixed(2),m=l.totalValue.toFixed(2),d="",c=null,u="",h=null;switch(l.type){case"Pound":case"Euro":case"Dollar":case"Decimal":case"Number":case"Percentage":var g,v=parseFloat(m);"Pound"===l.type&&(n="&#163; "),"Dollar"===l.type&&(n="&#36; "),"Euro"===l.type&&(n="&#128; "),l.columns.reverse().forEach(function(a,o){var r="",i="",s="",m="",y=0,P="";m=m+","+a.label,r=r+","+a.maxValue,i=i+","+a.minValue,a.average=a.average||0,a.totalValue=a.totalValue||0,s=s+","+(a.averageOverride?a.averageOverride.toFixed(2):a.average.toFixed(2)),P=P+","+a.icon,o===l.columns.length-1&&(y+=a.totalValue),r=Polimapper.parseValueStrings(r),i=Polimapper.parseValueStrings(i),s=Polimapper.parseValueStrings(s),m=Polimapper.parseValueStrings(m),P=Polimapper.parseValueStrings(P),l.excludeMinFromDataSetSummaryGraph||(d+='<div class="legend-item"><span style="background-color:'+Polimapper.data.keyColour4+';"></span> Min</div>'),l.excludeAverageFromDataSetSummaryGraph||(d+='<div class="legend-item"><span style="background-color:'+Polimapper.data.keyColour3+';"></span> Avg</div>'),l.excludeMaxFromDataSetSummaryGraph||(d+='<div class="legend-item"><span style="background-color:'+Polimapper.data.keyColour1+';"></span> Max</div>'),l.isMultivalued?v=parseFloat(y.toFixed(2)):m[0]="",l.showTotalInDataSetSummary||(v=""),l.showAverageInDataSetSummary?c=l.description:(d=null,escapedName=null,c=null),""===P&&(P=[]);var f={fillColor:Polimapper.hexToRgba(Polimapper.data.keyColour4,20),highlightFill:Polimapper.data.keyColour4,data:i},b={fillColor:Polimapper.hexToRgba(Polimapper.data.keyColour3,20),highlightFill:Polimapper.data.keyColour3,data:s},w={fillColor:Polimapper.hexToRgba(Polimapper.data.keyColour1,20),highlightFill:Polimapper.data.keyColour1,data:r},C=[];if(l.excludeMinFromDataSetSummaryGraph||C.push(f),l.excludeAverageFromDataSetSummaryGraph||C.push(b),l.excludeMaxFromDataSetSummaryGraph||C.push(w),l.showAverageInDataSetSummary){g="Percentage"===l.type?Polimapper.templates["src/templates/percentageMobile.handlebars"]:Polimapper.templates["src/templates/mobileNumber.handlebars"];var k,_={refMax:k="Percentage"===l.type?100:p(r),getBarWidth:200*r/k},x={refMax:k,getBarWidth:200*s/k},S={refMax:k,getBarWidth:200*i/k};if(h={name:l.name,value:v,currency:Polimapper.decodeHtml(n),icons:P.reverse(),escapedName:Polimapper.toSlug(l.name),bigNumber:b.data>1e4,multivalued:l.isMultivalued,firstColumn:0===o,lastColumn:o===l.columns.length-1,label:a.label,description:c,total:l.showTotalInDataSetSummary,legend:""!==d,legendHtml:d,showGraph:l.showAverageInDataSetSummary,showMin:!l.excludeMinFromDataSetSummaryGraph,showAvg:!l.excludeAverageFromDataSetSummaryGraph,showMax:!l.excludeMaximumFromDataSetSummaryGraph,minDataset:f,avgDataset:b,maxDataset:w,setGraphBarWitdhMax:_,setGraphBarWitdhAvg:x,setGraphBarWitdhMin:S},u+=g(h),!l.isMultivalued){var D=e("#data .totals").append(u),I=e(".option-1",D).last(),A=e(".option-2",D).last();"Percentage"===l.type?A=[]:I=[],t(I,A,_,x,S)}}}),l.isMultivalued&&(e("#data .totals").append(u),e(".charts."+Polimapper.toSlug(l.name)).slick({dots:!0,arrows:!0})),e(".pretty-number").removeAttr("data-pretty-number"),e(".pretty-number").prettyNumber();break;case"Percentage":if(l.showAverageInDataSetSummary||l.showTotalInDataSetSummary)if(l.isMultivalued)Polimapper.drawMultivalueSummaryBarChart(l,r,i);else{var y=(0,Polimapper.templates["src/templates/percentageMobile.handlebars"])({name:l.name,value:s,icon:l.icon,escapedName:Polimapper.toSlug(l.name),label:i,description:l.description,showGraph:l.showAverageInDataSetSummary,showMin:!l.excludeMinFromDataSetSummaryGraph,showAvg:!l.excludeAverageFromDataSetSummaryGraph,showMax:!l.excludeMaximumFromDataSetSummaryGraph});e("#data .totals").append(y);Polimapper.data.keyColour1}}}}},Polimapper.loadNodeDataMobile=function(a){Polimapper.data.dataFields;var t=e("path[data-name='"+a+"']").get(0),i=(e(t).attr("data-name"),function(e){var a=Polimapper.data[e.className.baseVal.trim()];return a||(a="#dedede"),a}(t));a=Polimapper.arrayLookup(Polimapper.data.nodes,"name",a),Polimapper.loadRankingIcons(a);for(var n=Polimapper.orderDatafields(Polimapper.data.dataFields),s=0;s<n.length;s++){var m=n[s],d=m.name,c=m.columns[0].label?m.columns[0].label:m.name;if(a.field(d)){var u="",h="";switch(m.type){case"Pound":case"Euro":case"Dollar":case"Decimal":case"Number":case"Percentage":m.isMultivalued,"Pound"===m.type&&(u="&#163; "),"Dollar"===m.type&&(u="&#36; "),"Euro"===m.type&&(u="&#128; "),m.columns.reverse().forEach(function(o,t){var n=parseFloat(a.columnValue(d,d)),s=o.averageOverride?o.averageOverride.toFixed(2):o.average.toFixed(2),c="",g="",y="",P="",f="",b=a.column(m.name,o.name);y=y+","+o.label,P=P+","+o.maxValue,f=f+","+(o.averageOverride?o.averageOverride.toFixed(2):o.average.toFixed(2)),c=c+","+o.icon,b.value&&(g=g+","+b.value,n=parseFloat(b.value),t===m.columns.length-1&&parseFloat(b.value)),g=Polimapper.parseValueStrings(g),y=Polimapper.parseValueStrings(y),c=Polimapper.parseValueStrings(c),P=Polimapper.parseValueStrings(P),f=Polimapper.parseValueStrings(f),y[0]=Polimapper.data.topology.labelForSingularNode,""===(c=[m.columns[0].icon])&&(c=[]);var w,C={fillColor:Polimapper.hexToRgba(i,20),highlightFill:i,data:n},k={fillColor:"rgba(220,220,220,.20)",highlightFill:"rgba(220,220,220,1)",data:f},_={refMax:w="Percentage"===m.type?100:p(n>s?n:s),getBarWidth:Math.abs(200*n/w)},x={refMax:w,getBarWidth:Math.abs(200*s/w)},S={name:d,value:n,currency:Polimapper.decodeHtml(u),icons:c.reverse(),color:i,bigNumber:k.data>1e5,escapedName:Polimapper.toSlug(d),multivalued:m.isMultivalued,firstColumn:0===t,lastColumn:t===m.columns.length-1,label:o.label,description:m.description,node:a.name,showGraph:!0,showAvg:m.includeAverageInNodeGraphs,nodeDataset:C,avgDataset:k,setGraphBarWitdhNodeValue:_,setGraphBarWitdhAvg:x};if("Percentage"===m.type?v=Polimapper.templates["src/templates/percentageNodeMobile.handlebars"]:n>1e6?(v=Polimapper.templates["src/templates/mobileNumberNode.handlebars"],e(".n-value").addClass("pretty-number")):n<0?(v=Polimapper.templates["src/templates/minusNumberNode.handlebars"],n=Polimapper.numberWithCommas(n)):(v=Polimapper.templates["src/templates/mobileNumberNode.handlebars"],n=Polimapper.numberWithCommas(n)),h+=v(S),!m.isMultivalued){var D=e("#data .results").append(h),I=e(".node-graph",D).last();"Percentage"===m.type?r(I,x,_):l(I,x,_)}}),m.isMultivalued&&(e("#data .results").append(h),e(".charts."+Polimapper.toSlug(m.name)).slick({dots:!0,arrows:!0})),e(".pretty-number").removeAttr("data-pretty-number"),e(".pretty-number").prettyNumber();break;case"Percentage":if(m.isMultivalued)Polimapper.drawMultivalueBarChart(a,m,d,i,c);else{var g=a.columnValue(d,d),v=Polimapper.templates["src/templates/percentageNodeMobile.handlebars"],y={name:d,value:g,bigNumber:avgDataset.data>1e5,icon:m.columns[0].icon,escapedName:Polimapper.toSlug(d),label:c,showGraph:!0,description:m.description,nodeDataset:nodeDataset,avgDataset:avgDataset,setGraphBarWitdhNodeValue:setGraphBarWitdhNodeValue,setGraphBarWitdhAvg:setGraphBarWitdhAvg};h=v(y);e("#data .results").append(h);var P=[{value:g,color:i,highlight:"#FF5A5E",label:d},{value:100-g,color:"#f1f1f1",highlight:"#f1f1f1",label:""}],f=e("#"+Polimapper.toSlug(d)).get(0).getContext("2d");new o(f).Doughnut(P,{animateScale:!0,labelLength:30,segmentShowStroke:!1})}break;case"Hyperlink":if(w=a.columnValue(d,d)){v=Polimapper.templates["src/templates/link.handlebars"];var b=w.split(":::");y={name:d,url:b[0],text:b[1],icon:m.columns[0].icon,label:c},h=v(y);e("#data .results").append(h)}break;case"Text":default:var w=a.columnValue(d,d),C=(v=Polimapper.templates["src/templates/text.handlebars"],Polimapper.templates["src/templates/textMobile.handlebars"]);y={name:d,value:w,icon:m.columns[0].icon,escapedName:Polimapper.toSlug(d),label:c},h=v(y),C(y);e("#data .results").append(h)}}}},Polimapper.drawMultivalueBarChartMobile=function(a,t,l,r,i){var p=a.columnValue(l,l),n="",s="",m="";t.columns.forEach(function(e,o){var l=a.column(t.name,e.name);m=m+","+e.label,n=n+","+e.icon,l.value&&(s=s+","+l.value,o===t.columns.length-1&&parseFloat(l.value))}),s=Polimapper.parseValueStrings(s),m=Polimapper.parseValueStrings(m),n=Polimapper.parseValueStrings(n),template=Polimapper.templates["src/templates/mobileNumberNode.handlebars"],""===n&&(n=[]);var d,c={name:l,value:p,bigNumber:p>1e5,color:r,escapedName:Polimapper.toSlug(l),icons:n.reverse(),multivalued:t.isMultivalued,label:i,description:t.description,showGraph:!0},u=template(c);if(e("#data .results").append(u),t.includeAverageInNodeGraphs){var h="";m="";for(var g=0;g<t.columns.length;g++)h=t.averageOverride?h+","+t.columns[g].averageOverride.toFixed(2):h+","+t.columns[g].average.toFixed(2),m=m+","+t.columns[g].name;h=Polimapper.parseValueStrings(h),d={labels:m=Polimapper.parseValueStrings(m),datasets:[{label:a.name,fillColor:Polimapper.hexToRgba(r,60),strokeColor:r,highlightFill:r,highlightStroke:r,pointColor:"#ffffff",pointStrokeColor:r,pointHighlightFill:r,pointHighlightStroke:"#ffffff",data:s},{label:"Average",fillColor:"rgba(220,220,220,0.5)",strokeColor:"rgba(220,220,220,0.8)",highlightFill:"rgba(220,220,220,0.75)",highlightStroke:"rgba(220,220,220,1)",data:h}]}}else d={labels:m,datasets:[{label:a.name,fillColor:Polimapper.hexToRgba(r,60),strokeColor:r,highlightFill:r,highlightStroke:r,data:s}]};var v=e("#"+Polimapper.toSlug(l)).get(0).getContext("2d");new o(v).Bar(d,{responsive:!0,labelLength:4,showTooltips:!1,onAnimationComplete:function(){var e=this.chart.ctx;e.font=this.scale.font,e.fillStyle=this.scale.textColor,e.textAlign="center",e.textBaseline="bottom",this.datasets.forEach(function(a){a.bars.forEach(function(a){e.fillText(a.value,a.x,a.y+25)})})}})}}(Polimapper.$||window.$,Polimapper._||window._,Polimapper.Chart||window.Chart);